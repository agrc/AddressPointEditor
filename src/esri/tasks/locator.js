//>>built
define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/Deferred","dojo/_base/json","dojo/has","esri/kernel","esri/request","esri/deferredUtils","esri/tasks/Task","esri/tasks/AddressCandidate"],function(q,i,r,m,j,t,u,n,o,s,p){return q(s,{declaredClass:"esri.tasks.Locator",_eventMap:{"address-to-locations-complete":["addresses"],"addresses-to-locations-complete":["addresses"],"location-to-address-complete":["address"]},constructor:function(){this._geocodeHandler=i.hitch(this,this._geocodeHandler);
this._geocodeAddressesHandler=i.hitch(this,this._geocodeAddressesHandler);this._reverseGeocodeHandler=i.hitch(this,this._reverseGeocodeHandler);this.registerConnectEvents()},outSpatialReference:null,setOutSpatialReference:function(a){this.outSpatialReference=a},_geocodeHandler:function(a,d,h,f,b){try{var g=a.candidates,e,d=[],c,k=g.length,l=a.spatialReference,i;for(c=0;c<k;c++){e=g[c];if(i=e.location)i.spatialReference=l;d[c]=new p(e)}this._successHandler([d],"onAddressToLocationsComplete",h,b)}catch(j){this._errorHandler(j,
f,b)}},_geocodeAddressesHandler:function(a,d,h,f,b){try{var g=a.locations,d=[],e,c=g.length,k=a.spatialReference,l;for(e=0;e<c;e++){if(l=g[e].location)l.spatialReference=k;d[e]=new p(g[e])}this._successHandler([d],"onAddressesToLocationsComplete",h,b)}catch(i){this._errorHandler(i,f,b)}},addressToLocations:function(a,d,h,f,b){if(a.address)f=h,h=d,d=a.outFields,b=a.searchExtent,a=a.address;b&&(b=b._normalize(!0));var g=this.outSpatialReference,a=this._encode(i.mixin({},this._url.query,a,{f:"json",
outSR:g&&j.toJson(g.toJson()),outFields:d&&d.join(",")||null,searchExtent:b&&j.toJson(b.toJson())})),e=this._geocodeHandler,c=this._errorHandler,k=new m(o._dfdCanceller);k._pendingDfd=n({url:this._url.path+"/findAddressCandidates",content:a,callbackParamName:"callback",load:function(a,b){e(a,b,h,f,k)},error:function(a){c(a,f,k)}});return k},addressesToLocations:function(a,d,h){var f=this.outSpatialReference,b=[];r.forEach(a.addresses,function(a){b.push({attributes:a})});var a=this._encode(i.mixin({},
this._url.query,{addresses:j.toJson({records:b})},{f:"json",outSR:f&&j.toJson(f.toJson())})),g=this._geocodeAddressesHandler,e=this._errorHandler,c=new m(o._dfdCanceller);c._pendingDfd=n({url:this._url.path+"/geocodeAddresses",content:a,callbackParamName:"callback",load:function(a,b){g(a,b,d,h,c)},error:function(a){e(a,h,c)}});return c},_reverseGeocodeHandler:function(a,d,h,f,b){try{this._successHandler([new p({address:a.address,location:a.location,score:100})],"onLocationToAddressComplete",h,b)}catch(g){this._errorHandler(g,
f,b)}},locationToAddress:function(a,d,h,f){a&&this.normalization&&(a=a.normalize());var b=this.outSpatialReference,a=this._encode(i.mixin({},this._url.query,{outSR:b&&j.toJson(b.toJson()),location:a&&j.toJson(a.toJson()),distance:d,f:"json"})),g=this._reverseGeocodeHandler,e=this._errorHandler,c=new m(o._dfdCanceller);c._pendingDfd=n({url:this._url.path+"/reverseGeocode",content:a,callbackParamName:"callback",load:function(a,b){g(a,b,h,f,c)},error:function(a){e(a,f,c)}});return c},onAddressToLocationsComplete:function(){},
onAddressesToLocationsComplete:function(){},onLocationToAddressComplete:function(){}})});