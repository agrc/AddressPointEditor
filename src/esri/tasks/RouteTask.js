//>>built
define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/has","esri/kernel","esri/graphic","esri/request","esri/geometry/normalizeUtils","esri/tasks/Task","esri/tasks/RouteResult","esri/tasks/NAMessage"],function(g,j,k,B,C,u,n,v,w,x,y){g=g(w,{declaredClass:"esri.tasks.RouteTask",_eventMap:{"solve-complete":["result"]},constructor:function(){this._url.path+="/solve";this._handler=j.hitch(this,this._handler);this.registerConnectEvents()},__msigns:[{n:"solve",c:3,a:[{i:0,p:["stops.features","barriers.features",
"polylineBarriers.features","polygonBarriers.features"]}],e:2}],_handler:function(a,g,h,l,e){try{var c=[],b=[],f=a.routes?a.routes.features:[],m=a.stops?a.stops.features:[],o=a.barriers?a.barriers.features:[],z=a.polygonBarriers?a.polygonBarriers.features:[],A=a.polylineBarriers?a.polylineBarriers.features:[],p=a.messages,i=k.forEach,j=k.indexOf,q=!0,d,r,s=a.routes&&a.routes.spatialReference||a.stops&&a.stops.spatialReference||a.barriers&&a.barriers.spatialReference||a.polygonBarriers&&a.polygonBarriers.spatialReference||
a.polylineBarriers&&a.polylineBarriers.spatialReference;i(a.directions||[],function(a){c.push(d=a.routeName);b[d]={directions:a}});i(f,function(a){if(-1===j(c,d=a.attributes.Name))c.push(d),b[d]={};b[d].route=a});i(m,function(a){r=a.attributes;if(-1===j(c,d=r.RouteName||"esri.tasks.RouteTask.NULL_ROUTE_NAME"))c.push(d),b[d]={};"esri.tasks.RouteTask.NULL_ROUTE_NAME"!==d&&(q=!1);if(void 0===b[d].stops)b[d].stops=[];b[d].stops.push(a)});if(0<m.length&&!0===q)b[c[0]].stops=b["esri.tasks.RouteTask.NULL_ROUTE_NAME"].stops,
delete b["esri.tasks.RouteTask.NULL_ROUTE_NAME"],c.splice(k.indexOf(c,"esri.tasks.RouteTask.NULL_ROUTE_NAME"),1);var t=[];i(c,function(a){b[a].routeName="esri.tasks.RouteTask.NULL_ROUTE_NAME"===a?null:a;b[a].spatialReference=s;t.push(new x(b[a]))});a=function(a){i(a,function(b,c){if(b.geometry)b.geometry.spatialReference=s;a[c]=new u(b)});return a};i(p,function(a,b){p[b]=new y(a)});this._successHandler([{routeResults:t,barriers:a(o),polygonBarriers:a(z),polylineBarriers:a(A),messages:p}],"onSolveComplete",
h,e)}catch(n){this._errorHandler(n,l,e)}},solve:function(a,g,h,l){var e=a.stops;if(e&&"esri.tasks.FeatureSet"===e.declaredClass){var c=[],b=!1,f;k.forEach(e.features,function(a){f=a.attributes;if((!f||!f.RouteName)&&!b)b=!0;else if(-1===k.indexOf(c,f?f.RouteName:""))c.push(f?f.RouteName:"")});if(1<c.length&&b)throw b=Error("'RouteName' not specified for atleast 1 stop in stops FeatureSet."),this.onError(b),h&&h(b),b;}var e=l.assembly,a=this._encode(j.mixin({},this._url.query,{f:"json"},a.toJson(e&&
e[0]))),m=this._handler,o=this._errorHandler;return n({url:this._url.path,content:a,callbackParamName:"callback",load:function(a,b){m(a,b,g,h,l.dfd)},error:function(a){o(a,h,l.dfd)}})},onSolveComplete:function(){}});v._createWrappers(g);return g});