//>>built
define(["dojo/_base/array","dojo/_base/json","dojo/_base/kernel","dojo/_base/lang","dojo/date","dojo/has","dojo/number","dojo/date/locale","esri/kernel"],function(j,m,n,g,o,s,p,q){function i(b){return void 0!==b&&null!==b}function k(b,d,a){var c=a.match(/([^\(]+)(\([^\)]+\))?/i),e=g.trim(c[1]),a=d[b],c=m.fromJson((c[2]?g.trim(c[2]):"()").replace(/^\(/,"({").replace(/\)$/,"})")),f=c.utcOffset;if(-1===j.indexOf(r,e))e=g.getObject(e),g.isFunction(e)&&(a=e(a,b,d));else if("number"===typeof a||"string"===typeof a&&
a&&!isNaN(Number(a)))switch(a=Number(a),e){case "NumberFormat":return p.format(a,c);case "DateString":b=new Date(a);if(c.local||c.systemLocale)return c.systemLocale?b.toLocaleDateString()+(c.hideTime?"":" "+b.toLocaleTimeString()):b.toDateString()+(c.hideTime?"":" "+b.toTimeString());b=b.toUTCString();c.hideTime&&(b=b.replace(/\s+\d\d\:\d\d\:\d\d\s+(utc|gmt)/i,""));return b;case "DateFormat":return b=new Date(a),i(f)&&(b=o.add(b,"minute",b.getTimezoneOffset()-f)),q.format(b,c)}return i(a)?a:""}function l(b,
d){var a;if(d)for(a in b)b.hasOwnProperty(a)&&(void 0===b[a]||null===b[a]?delete b[a]:b[a]instanceof Object&&l(b[a],!0));else for(a in b)b.hasOwnProperty(a)&&void 0===b[a]&&delete b[a];return b}var r=["NumberFormat","DateString","DateFormat"];return{valueOf:function(b,d){for(var a in b)if(b[a]==d)return a;return null},substitute:function(b,d,a){var c,e,f;if(i(a))g.isObject(a)?(c=a.first,e=a.dateFormat,f=a.numberFormat):c=a;if(!d||"${*}"===d){var d=[],h;for(h in b){a=b[h];if(e&&-1!==j.indexOf(e.properties||
"",h))a=k(h,b,e.formatter||"DateString");else if(f&&-1!==j.indexOf(f.properties||"",h))a=k(h,b,f.formatter||"NumberFormat");d.push(h+" = "+(i(a)?a:"")+"<br/>");if(c)break}return d.join("")}return g.replace(d,g.hitch({obj:b},function(b,a){var c=a.split(":");return 1<c.length?(a=c[0],c.shift(),k(a,this.obj,c.join(":"))):e&&-1!==j.indexOf(e.properties||"",a)?k(a,this.obj,e.formatter||"DateString"):f&&-1!==j.indexOf(f.properties||"",a)?k(a,this.obj,f.formatter||"NumberFormat"):i(this.obj[a])?this.obj[a]:
""}),/\$\{([^\}]+)\}/g)},filter:function(b,d,a){var d=[g.isString(b)?b.split(""):b,a||n.global,g.isString(d)?new Function("item","index","array",d):d],a={},c,b=d[0];for(c in b)d[2].call(d[c],b[c],c,b)&&(a[c]=b[c]);return a},isDefined:i,fixJson:l}});