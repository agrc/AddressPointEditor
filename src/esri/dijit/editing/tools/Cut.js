//>>built
define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/connect","dojo/has","dojo/DeferredList","esri/graphicsUtils","esri/graphic","esri/tasks/query","esri/layers/FeatureLayer","esri/toolbars/draw","esri/dijit/editing/Cut","esri/dijit/editing/tools/ToggleToolBase","esri/kernel"],function(g,e,c,f,t,l,m,i,n,o,p,q,r){return g([r],{declaredClass:"esri.dijit.editing.tools.Cut",id:"btnFeatureCut",_enabledIcon:"toolbarIcon cutIcon",_disabledIcon:"toolbarIcon cutIcon",_drawType:p.POLYLINE,_enabled:!0,
_label:"NLS_cutLbl",_cutConnects:[],activate:function(){this._cutConnects.push(f.connect(this._toolbar,"onDrawEnd",this,"_onDrawEnd"));this.inherited(arguments)},deactivate:function(){this.inherited(arguments);c.forEach(this._cutConnects,f.disconnect);this._cutConnects=[];this._edits=[]},_onDrawEnd:function(s){var d=this._cutLayers=c.filter(this._settings.layers,function(a){return"esriGeometryPolygon"===a.geometryType||"esriGeometryPolyline"===a.geometryType&&a.visible&&a._isMapAtVisibleScale()});
this._cutConnects=this._cutConnects.concat(c.map(d,e.hitch(this,function(a){return f.connect(a,"onEditsComplete",e.hitch(this,function(){if(this._settings.undoRedoManager){var a=this._settings.undoRedoManager;c.forEach(this._edits,e.hitch(this,function(b){a.add(new q({featureLayer:b.layer,addedGraphics:b.adds,preUpdatedGraphics:b.preUpdates,postUpdatedGraphics:b.updates}))}),this)}this.onFinished()}))})));var b=new n;b.geometry=s;c.forEach(d,function(a){this._settings.editor._selectionHelper.selectFeatures([a],
b,o.SELECTION_NEW,e.hitch(this,"_cutFeatures",a,b))},this)},_cutFeatures:function(c,d,b){if(b&&b.length){this._edits=[];var a=[];a.push(this._settings.geometryService.cut(m.getGeometries(b),d.geometry,e.hitch(this,"_cutHandler",c,b)));(new l(a)).addCallback(e.hitch(this,function(){this.onApplyEdits(this._edits)}))}},_cutHandler:function(f,d,b){var a=[],j=[],g=c.map(d,function(a){return new i(e.clone(a.toJson()))}),k,h;c.forEach(b.cutIndexes,function(c,f){k!=c?(k=c,j.push(d[c].setGeometry(b.geometries[f]))):
(h=new i(b.geometries[f],null,e.mixin({},d[c].attributes),null),h.attributes[d[0].getLayer().objectIdField]=null,a.push(h))},this);this._edits.push({layer:f,adds:a,updates:j,preUpdates:g})}})});