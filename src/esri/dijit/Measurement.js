//>>built
require({cache:{"url:esri/dijit/templates/Measurement.html":"<div class=\"esriMeasurement\">\r\n  <div dojoType='dijit.form.ToggleButton' baseClass='esriButton' dojoAttachPoint='area' checked='false' iconClass='areaIcon' showLabel='false' dojoAttachEvent='onClick:areaToggleButton'></div>\r\n  <div dojoType='dijit.form.ToggleButton' baseClass='esriButton' dojoAttachPoint='distance' iconClass='distanceIcon' showLabel='false' dojoAttachEvent='onClick:distanceToggleButton'></div>\r\n  <div dojoType='dijit.form.ToggleButton' baseClass='esriButton' dojoAttachPoint='location' iconClass='locationIcon' showLabel='false' dojoAttachEvent='onClick:locationToggleButton'></div>\r\n  <div style=\"display:inline;margin-left:2px;margin-right:2px;padding-top:2px;\">|</div>\r\n  <button dojoType='dijit.form.DropDownButton' baseClass='esriToggleButton' dojoAttachPoint='unit' label='unit' value='unit' style='visibility:hidden;'></button>\r\n  <div dojoType='dijit.layout.ContentPane' dojoAttachPoint='resultLabel' class='resultLabel'></div>\r\n  <div dojoType='dijit.layout.ContentPane' dojoAttachPoint='resultValue' align='left' class='result'></div>\r\n</div>"}});
define(["require","dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/connect","dojo/_base/Color","dojo/has","dojo/number","dojo/dom-style","dijit/_Widget","dijit/_Templated","dijit/registry","dijit/Menu","dijit/MenuItem","esri/SpatialReference","esri/symbols/PictureMarkerSymbol","esri/symbols/SimpleLineSymbol","esri/geometry/geodesicUtils","esri/geometry/webMercatorUtils","esri/geometry/Point","esri/geometry/Polyline","esri/geometry/Polygon","esri/graphic","esri/tasks/AreasAndLengthsParameters","esri/tasks/LengthsParameters","esri/tasks/GeometryService","esri/kernel","esri/config","esri/domUtils","esri/lang","esri/units","esri/WKIDUnitConversion","esri/dijit/_EventedWidget","dojo/text!esri/dijit/templates/Measurement.html","dojo/i18n!esri/nls/jsapi","dijit/form/ToggleButton","dijit/form/DropDownButton","dijit/layout/ContentPane"],
function(v,w,f,m,d,x,L,q,y,z,A,e,o,p,r,B,s,n,k,C,i,t,j,D,E,F,M,G,u,H,l,I,J,K,h){return w([J,z,A],{declaredClass:"esri.dijit.Measurement",widgetsInTemplate:!0,templateString:K,unitDictionary:[],result:null,inputPoints:[],measureGraphics:[],numberPattern:"#,###,###,##0.0",_eventMap:{"measure-end":["toolName","geometry"]},constructor:function(a){a=a||{};if(a.map){this._map=a.map;if(this._map.loaded)this._map.cs=this._checkCS(this._map.spatialReference);else var b=d.connect(this._map,"onLoad",this,function(){d.disconnect(b);
b=null;this._map.cs=this._checkCS(this._map.spatialReference)});this._geometryService=G.defaults.geometryService;if(a.pointSymbol)this._pointSymbol=a.pointSymbol;else{var c=v.toUrl("esri/dijit/images/flag.png");this._pointSymbol=new B(c,24,24);this._pointSymbol.setOffset(9,11)}this._lineSymbol=a.lineSymbol?a.lineSymbol:new s(s.STYLE_SOLID,new x([0,128,255]),3);this._defaultLengthUnit=a.defaultLengthUnit?a.defaultLengthUnit:l.MILES;this._defaultAreaUnit=a.defaultAreaUnit?a.defaultAreaUnit:l.ACRES;
this._defaultLocationUnit=a.defaultLocationUnit?a.defaultLocationUnit:l.DECIMAL_DEGREES;this._snappingCallback=f.hitch(this,this._snappingCallback)}else console.log("dijit.MeasureTool: unable to find the 'map' property in parameters")},startup:function(){var a=h.widgets.measurement;this.unitDictionary[a.NLS_length_miles]=1;this.unitDictionary[a.NLS_length_kilometers]=1.609344;this.unitDictionary[a.NLS_length_feet]=5280;this.unitDictionary[a.NLS_length_meters]=1609.34;this.unitDictionary[a.NLS_length_yards]=
1760;this.unitDictionary["Nautical Miles"]=0.869;this.unitDictionary[a.NLS_area_acres]=1;this.unitDictionary[a.NLS_area_sq_kilometers]=0.004047;this.unitDictionary[a.NLS_area_sq_miles]=0.0015625;this.unitDictionary[a.NLS_area_sq_feet]=43560;this.unitDictionary[a.NLS_area_sq_meters]=4046.87;this.unitDictionary[a.NLS_area_hectares]=0.4047;this.unitDictionary[a.NLS_area_sq_yards]=4840;this.units={esriMiles:a.NLS_length_miles,esriKilometers:a.NLS_length_kilometers,esriFeet:a.NLS_length_feet,esriMeters:a.NLS_length_meters,
esriYards:a.NLS_length_yards,esriAcres:a.NLS_area_acres,esriSquareKilometers:a.NLS_area_sq_kilometers,esriSquareMiles:a.NLS_area_sq_miles,esriSquareFeet:a.NLS_area_sq_feet,esriSquareMeters:a.NLS_area_sq_meters,esriHectares:a.NLS_area_hectares,esriSquareYards:a.NLS_area_sq_yards,esriDecimalDegrees:a.NLS_decimal_degrees,esriDegreeMinuteSeconds:a.NLS_deg_min_sec};e.byNode(this.distance.domNode).setLabel(h.widgets.measurement.NLS_distance);e.byNode(this.area.domNode).setLabel(h.widgets.measurement.NLS_area);
e.byNode(this.location.domNode).setLabel(h.widgets.measurement.NLS_location);e.byNode(this.resultLabel.domNode).setContent(h.widgets.measurement.NLS_resultLabel)},measureArea:function(){this._map.navigationManager.setImmediateClick(!0);this._createAreaUnitList();this.inputPoints=[];this.tempGraphic=new j;this.tempGraphic.setSymbol(this._lineSymbol);this.tempGraphic.setGeometry(new i(this._map.spatialReference));this._map.graphics.add(this.tempGraphic);if("PCS"===this._map.cs)this._geometryAreaHandler=
d.connect(this._geometryService,"onAreasAndLengthsComplete",this,"_outputArea");this.mouseClickMapHandler=d.connect(this._map,"onClick",this,"_measureAreaMouseClickHandler");this.doubleClickMapHandler=d.connect(this._map,"onDblClick",this,"_measureAreaDblClickHandler")},measureDistance:function(){this._map.navigationManager.setImmediateClick(!0);if("PCS"===this._map.cs)this._projectMapExtent(this._map.extent),this._mapExtentChangeHandler=d.connect(this._map,"onExtentChange",this,"_projectMapExtent");
this.inputPoints=[];this._createLengthUnitList();this.mouseClickMapHandler=d.connect(this._map,"onClick",this,"_measureDistanceMouseClickHandler");this.doubleClickMapHandler=d.connect(this._map,"onDblClick",this,"_measureDistanceDblClickHandler")},measureLocation:function(){this._map.navigationManager.setImmediateClick(!0);this.measureGraphics=[];this._createLocationUnitList();this._map.graphics.remove(this.locationGraphic);if("PCS"===this._map.cs)this._projectMapExtent(this._map.extent),this._mapExtentChangeHandler=
d.connect(this._map,"onExtentChange",f.hitch(this,this._projectMapExtent));this._clickMapHandler=d.connect(this._map,"onClick",this,"_measureLocationClickHandler");this.mouseMoveMapHandler=d.connect(this._map,"onMouseMove",this,"_showCoordinates");this.mouseDragMapHandler=d.connect(this._map,"onMouseDrag",f.hitch(this,function(){e.byNode(this.resultValue.domNode).setAttribute("disabled",!0)}))},setTool:function(a,b){this.closeTool();var c=e.byNode(this[a].domNode).checked;y.set(this.unit.domNode,
"visibility","visible");e.byNode(this.area.domNode).setAttribute("checked",!1);e.byNode(this.distance.domNode).setAttribute("checked",!1);e.byNode(this.location.domNode).setAttribute("checked",!1);if(!0===b||!1===b)c=b;e.byNode(this[a].domNode).setAttribute("checked",c);if(c)this.activeTool=a,this.map.isDoubleClickZoom&&this._map.disableDoubleClickZoom(),"area"===a?this.measureArea():"distance"===a?this.measureDistance():"location"===a&&this.measureLocation(),this._map.snappingManager&&(this._map.snappingManager._startSelectionLayerQuery(),
this._map.snappingManager._setUpSnapping())},areaToggleButton:function(){this.clearResult();this.setTool("area")},distanceToggleButton:function(){this.clearResult();this.setTool("distance")},locationToggleButton:function(){this.clearResult();this.setTool("location")},closeTool:function(){var a=this._map;a.navigationManager.setImmediateClick(!1);a.isDoubleClickZoom||a.enableDoubleClickZoom();this.inputPoints=[];a.snappingManager&&a.snappingManager._snappingGraphic&&a.graphics.remove(a.snappingManager._snappingGraphic);
d.disconnect(this.mouseClickMapHandler);d.disconnect(this.mouseMoveMapHandler);d.disconnect(this.doubleClickMapHandler);d.disconnect(this.mouseDragMapHandler);d.disconnect(this._clickMapHandler);d.disconnect(this._mapExtentChangeHandler);d.disconnect(this._geometryAreaHandler);this.mouseClickMapHandler=this.mouseMoveMapHandler=this.doubleClickMapHandler=this.mouseDragMapHandler=this._clickMapHandler=this._mapExtentChangeHandler=this._geometryAreaHandler=null;this._map.snappingManager&&(this._map.snappingManager._stopSelectionLayerQuery(),
this._map.snappingManager._killOffSnapping())},clearResult:function(){var a=this._map;this.result=0;e.byNode(this.resultValue.domNode).setAttribute("content","");var b;for(b=0;b<this.measureGraphics.length;b++)a.graphics.remove(this.measureGraphics[b]);this.measureGraphics=[];a.graphics.remove(this.tempGraphic)},show:function(){u.show(this.domNode)},hide:function(){u.hide(this.domNode)},showTool:function(a){this[a].domNode.style.display="inline"},hideTool:function(a){this[a].domNode.style.display=
"none"},destroy:function(){this.closeTool();this.clearResult();this.inherited(arguments);this._map=this._geometryService=this.measureGraphic=this.measureGraphic=this.tempGraphic=null},onMeasureEnd:function(){},_densifyGeometry:function(a){"Web Mercator"===this._map.cs&&(a=k.webMercatorToGeographic(a));a="PCS"===this._map.cs?a:n.geodesicDensify(a,5E5);"Web Mercator"===this._map.cs&&(a=k.geographicToWebMercator(a));return a},_measureAreaMouseClickHandler:function(a){var b;if(this._map.snappingManager)b=
this._map.snappingManager._snappingPoint;a=b||a.mapPoint;this.inputPoints.push(a);this._currentStartPt=a;if(1===this.inputPoints.length){this.tempGraphic.setGeometry(new i(this._map.spatialReference));for(b=0;b<this.measureGraphics.length;b++)this._map.graphics.remove(this.measureGraphics[b]);this.measureGraphics=[];this.result=0;this._outputResult(this.result,h.widgets.measurement.NLS_area_acres);this.mouseMoveMapHandler=d.connect(this._map,"onMouseMove",this,"_measureAreaMouseMoveHandler")}this.measureGraphic=
new j;this.measureGraphic.setSymbol(this._lineSymbol);this.measureGraphics.push(this.measureGraphic);if(1<this.inputPoints.length){var c=new i(this._map.spatialReference);c.addPath([this.inputPoints[this.inputPoints.length-2],a]);b=new i(this._map.spatialReference);b.addPath([this.inputPoints[0],a]);a=this._densifyGeometry(c);this.tempGraphic.setGeometry(this._densifyGeometry(b));this.measureGraphic.setGeometry(a);this._map.graphics.add(this.measureGraphic)}},_measureAreaMouseMoveHandler:function(a){var b;
if(0<this.inputPoints.length){var c=new i(this._map.spatialReference),g;if(this._map.snappingManager)g=this._map.snappingManager._snappingPoint;b=g||a.mapPoint;c.addPath([this._currentStartPt,b]);this.tempGraphic.setGeometry(this._densifyGeometry(c))}1<this.inputPoints.length&&(a=new i(this._map.spatialReference),a.addPath([b,this.inputPoints[0]]),this.tempGraphic.setGeometry(this.tempGraphic.geometry.addPath(this._densifyGeometry(a).paths[0])))},_measureAreaDblClickHandler:function(){d.disconnect(this.mouseMoveMapHandler);
this.mouseMoveMapHandler=null;var a=new t(this._map.spatialReference),b=[],c;for(c=0;c<this.inputPoints.length;c++)b.push([this.inputPoints[c].x,this.inputPoints[c].y]);b.push([this.inputPoints[0].x,this.inputPoints[0].y]);a.addRing(b);this.inputPoints=[];this.measurementGeometry=this._densifyGeometry(a);this._getArea(a)},_getArea:function(a){var b=[],c=new D;c.areaUnit=F.UNIT_ACRES;c.calculationType="geodesic";t.prototype.isSelfIntersecting(a)?this._geometryService.simplify([a],f.hitch(this,function(a){m.forEach(a,
f.hitch(this,function(e){"PCS"===this._map.cs?(c.polygons=a,this._geometryService.areasAndLengths(c)):("Web Mercator"===this._map.cs&&(e=k.webMercatorToGeographic(e)),b.push(e))}));this._showArea(n.geodesicAreas(b,l.ACRES)[0])})):("Web Mercator"===this._map.cs&&(a=k.webMercatorToGeographic(a)),b.push(a),"PCS"===this._map.cs?(c.polygons=b,this._geometryService.areasAndLengths(c)):(a=n.geodesicAreas(b,l.ACRES),this._showArea(Math.abs(a[0]))))},_outputArea:function(a){this._showArea(Math.abs(a.areas[0]))},
_showArea:function(a){if(a)this.result=a,this._outputResult(this.result,e.byNode(this.unit.domNode).label);this.onMeasureEnd(this.activeTool,this.measurementGeometry)},_measureDistanceDblClickHandler:function(){d.disconnect(this.mouseMoveMapHandler);this.mouseMoveMapHandler=null;var a=new i(this._map.spatialReference);a.addPath(this.inputPoints);a=this._densifyGeometry(a);if("PCS"===this._map.cs){var b=new E;b.polylines=[a];b.lengthUnit=9093;b.calculationType="geodesic";this._geometryService.lengths(b,
f.hitch(this,function(a){this.result=a.lengths[0];this._showDistance(this.result)}))}this.inputPoints=[];this.onMeasureEnd(this.activeTool,a)},_measureDistanceMouseClickHandler:function(a){var b;if(this._map.snappingManager)b=this._map.snappingManager._snappingPoint;a=b||a.mapPoint;this.inputPoints.push(a);this._currentStartPt=a;if(1===this.inputPoints.length){for(b=0;b<this.measureGraphics.length;b++)this._map.graphics.remove(this.measureGraphics[b]);this._map.graphics.remove(this.tempGraphic);this.measureGraphics=
[];this.result=0;this._outputResult(this.result,h.widgets.measurement.NLS_length_miles);this.tempGraphic=new j;this.tempGraphic.setSymbol(this._lineSymbol);this._map.graphics.add(this.tempGraphic);this.mouseMoveMapHandler=d.connect(this._map,"onMouseMove",this,"_measureDistanceMouseMoveHandler")}this.tempGraphic.setGeometry(new i(this._map.spatialReference));this.flagGraphic=new j;this.flagGraphic.setSymbol(this._pointSymbol);this.flagGraphic.setGeometry(a);this.measureGraphics.push(this.flagGraphic);
this._map.graphics.add(this.flagGraphic);if(1<this.inputPoints.length)this.measureGraphic=new j,this.measureGraphic.setSymbol(this._lineSymbol),this.measureGraphics.push(this.measureGraphic),b=new i(this._map.spatialReference),b.addPath([this.inputPoints[this.inputPoints.length-2],a]),this.measureGraphic.setGeometry(this._densifyGeometry(b)),this._map.graphics.add(this.measureGraphic),this.result+=this._geodesicDistance(this.inputPoints[this.inputPoints.length-2],a),this._showDistance(this.result)},
_measureDistanceMouseMoveHandler:function(a){if(0<this.inputPoints.length){var b=new i(this._map.spatialReference),c;if(this._map.snappingManager)c=this._map.snappingManager._snappingPoint;a=c||a.mapPoint;b.addPath([this._currentStartPt,a]);this.tempGraphic.setGeometry(this._densifyGeometry(b));this._showDistance(this._geodesicDistance(this._currentStartPt,a)+this.result)}},_geodesicDistance:function(a,b){var c=new i(this._map.spatialReference);"PCS"===this._map.cs&&(a=this._getGCSLocation(a),b=this._getGCSLocation(b));
c.addPath([a,b]);"Web Mercator"===this._map.cs&&(c=k.webMercatorToGeographic(c));return n.geodesicLengths([c],l.MILES)[0]},_showDistance:function(a){a&&this._outputResult(a,e.byNode(this.unit.domNode).label)},_measureLocationClickHandler:function(a){e.byNode(this.location.domNode).setAttribute("checked",!1);var b;if(this._map.snappingManager)b=this._map.snappingManager._snappingPoint;a=b||a.mapPoint;this.locationToggleButton();this.locationGraphic=new j;this.locationGraphic.setGeometry(a);this.locationGraphic.setSymbol(this._pointSymbol);
this._map.graphics.add(this.locationGraphic);this.measureGraphics.push(this.locationGraphic);b={mapPoint:a};"PCS"===this._map.cs?this._showCoordinates(b,!0):this._showCoordinates(b);this.onMeasureEnd(this.activeTool,a)},_getGCSLocation:function(a){if("Web Mercator"===this._map.cs)a=k.webMercatorToGeographic(a);else if("PCS"===this._map.cs&&this._map._newExtent)var b=Math.abs((this._map._newExtent.xmax-this._map._newExtent.xmin)/(this._map.extent.xmax-this._map.extent.xmin)),c=Math.abs((this._map._newExtent.ymax-
this._map._newExtent.ymin)/(this._map.extent.ymax-this._map.extent.ymin)),a=new C((a.x-this._map.extent.xmin)*b+this._map._newExtent.xmin,(a.y-this._map.extent.ymin)*c+this._map._newExtent.ymin,this._map.spatialReference);return a},_projectMapExtent:function(a){var a=new j(a),b=new r({wkid:4326});this._geometryService.project([a.geometry],b,f.hitch(this,function(a){if(!this.mouseMoveMapHandler&&"location"===this.activeTool)this.mouseMoveMapHandler=d.connect(this._map,"onMouseMove",f.hitch(this,this._showCoordinates)),
this.mouseDragMapHandler=d.connect(this._map,"onMouseDrag",f.hitch(this,function(){e.byNode(this.resultValue.domNode).setAttribute("disabled",!0)}));this._map._newExtent=a[0]}))},_showCoordinates:function(a,b){var c;if(this._map.snappingManager)c=this._map.snappingManager._snappingPoint;c=c||a.mapPoint;var g;if(b){var d=new r({wkid:4326});this._geometryService.project([c],d,f.hitch(this,function(a){g=a[0];this.locationX=g.x;this.locationY=g.y;this._outputLocationResult(g.x,g.y,e.byNode(this.unit.domNode).label)}))}else g=
this._getGCSLocation(c),this.locationX=g.x,this.locationY=g.y,this._outputLocationResult(g.x,g.y,e.byNode(this.unit.domNode).label)},_checkCS:function(a){if(a.wkid)return 3857===a.wkid||102100===a.wkid||102113===a.wkid?"Web Mercator":H.isDefined(I[a.wkid])?"PCS":"GCS";if(a.wkt)return-1!==a.wkt.indexOf("WGS_1984_Web_Mercator")?"Web Mercator":0===a.wkt.indexOf("PROJCS")?"PCS":"GCS"},_switchUnit:function(a){e.byNode(this.unit.domNode).setAttribute("label",a);null!==this.result&&this._outputResult(this.result,
a)},_outputResult:function(a,b){var c=a*this.unitDictionary[b];0===c?e.byNode(this.resultValue.domNode).setAttribute("content",""):1E6<c?e.byNode(this.resultValue.domNode).setAttribute("content",q.format(c.toPrecision(9),{pattern:this.numberPattern})+" "+b):e.byNode(this.resultValue.domNode).setAttribute("content",q.format(c.toFixed(2),{pattern:this.numberPattern})+" "+b)},_switchLocationUnit:function(a){e.byNode(this.unit.domNode).setAttribute("label",a);null===this.result||""===this.resultValue.domNode.innerHTML||
this._outputLocationResult(this.locationX,this.locationY,a)},_outputLocationResult:function(a,b,c){var g,d,f=h.widgets.measurement;c===f.NLS_decimal_degrees?(g=a.toFixed(6),d=b.toFixed(6)):c===f.NLS_deg_min_sec&&(f=c=!1,0>a&&(c=!0,a=Math.abs(a)),0>b&&(f=!0,b=Math.abs(b)),g=Math.floor(a)+"\u00b0"+Math.floor(60*(a-Math.floor(a)))+"'"+Math.floor(60*(60*(a-Math.floor(a))-Math.floor(60*(a-Math.floor(a)))))+'"',d=Math.floor(b)+"\u00b0"+Math.floor(60*(b-Math.floor(b)))+"'"+Math.floor(60*(60*(b-Math.floor(b))-
Math.floor(60*(b-Math.floor(b)))))+'"',c&&(g="-"+g),f&&(d="-"+d));e.byNode(this.resultValue.domNode).setAttribute("content",h.widgets.measurement.NLS_longitude+": "+g+"<br/>"+h.widgets.measurement.NLS_latitude+": "+d)},_createLengthUnitList:function(){var a=new o({style:"display: none;"}),b=h.widgets.measurement;m.forEach([b.NLS_length_miles,b.NLS_length_kilometers,b.NLS_length_feet,b.NLS_length_meters,b.NLS_length_yards],f.hitch(this,function(b){var d=new p({label:b,onClick:f.hitch(this,function(){this._switchUnit(b)})});
d.setAttribute("class","unitDropDown");a.addChild(d)}));e.byNode(this.unit.domNode).setAttribute("dropDown",a);b=this.units[this._defaultLengthUnit];e.byNode(this.unit.domNode).setAttribute("label",b)},_createAreaUnitList:function(){var a=new o({style:"display: none;"}),b=h.widgets.measurement;m.forEach([b.NLS_area_acres,b.NLS_area_sq_miles,b.NLS_area_sq_kilometers,b.NLS_area_hectares,b.NLS_area_sq_yards,b.NLS_area_sq_feet,b.NLS_area_sq_meters],f.hitch(this,function(b){var d=new p({label:b,onClick:f.hitch(this,
function(){this._switchUnit(b)})});d.setAttribute("class","unitDropDown");a.addChild(d)}));e.byNode(this.unit.domNode).setAttribute("dropDown",a);b=this.units[this._defaultAreaUnit];e.byNode(this.unit.domNode).setAttribute("label",b)},_createLocationUnitList:function(){var a=new o({style:"display: none;"}),b=h.widgets.measurement;m.forEach([b.NLS_decimal_degrees,b.NLS_deg_min_sec],f.hitch(this,function(b){var d=new p({label:b,onClick:f.hitch(this,function(){this._switchLocationUnit(b)})});d.setAttribute("class",
"unitDropDown");a.addChild(d)}));e.byNode(this.unit.domNode).setAttribute("dropDown",a);b=this.units[this._defaultLocationUnit];e.byNode(this.unit.domNode).setAttribute("label",b)}})});