//>>built
require({cache:{"url:esri/dijit/templates/OverviewMap.html":'<div class="esriOverviewMap">\r\n  <div class="ovwContainer" dojoattachpoint="_body" style="width: ${width}px; height: ${height}px;">\r\n    <div id="${id}-map" style="width: 100%; height: 100%;">\r\n      <div class="ovwHighlight" dojoattachpoint="_focusDiv" title="${NLS_drag}" style="border: 1px solid ${color}; background-color: ${color};"></div>\r\n    </div>\r\n  </div>\r\n  <div class="ovwButton ovwController" title="${NLS_show}" dojoattachpoint="_controllerDiv" dojoattachevent="onclick: _visibilityHandler">\r\n  </div>\r\n  <div class="ovwButton ovwMaximizer" title="${NLS_maximize}" dojoattachpoint="_maximizerDiv" dojoattachevent="onclick: _maximizeHandler">\r\n  </div>\r\n</div>\r\n'}});
define(["require","dojo/_base/declare","dojo/_base/lang","dojo/_base/connect","dojo/_base/html","dojo/has","dojo/sniff","dojo/dom-class","dojo/dom-style","dojo/dnd/Moveable","dijit/_Widget","dijit/_Templated","esri/map","esri/geometry/Point","esri/geometry/ScreenPoint","esri/layers/TiledMapServiceLayer","esri/layers/DynamicMapServiceLayer","esri/layers/ArcGISTiledMapServiceLayer","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/ArcGISImageServiceLayer","esri/layers/OpenStreetMapLayer","esri/virtualearth/VETiledLayer","esri/kernel","esri/config","esri/domUtils","dojo/text!esri/dijit/templates/OverviewMap.html","dojo/i18n!esri/nls/jsapi"],
function(l,m,k,c,n,o,D,d,g,p,q,r,s,i,t,u,v,w,x,y,z,A,E,j,f,B,C){return m([q,r],{declaredClass:"esri.dijit.OverviewMap",widgetsInTemplate:!0,templateString:B,basePath:l.toUrl("esri/dijit")+"/",constructor:function(a,b){k.mixin(this,C.widgets.overviewMap);a=a||{};if(a.map){var e={};if(b)this._detached=!0,e=n.coords(b,!0);this.map=a.map;this.baseLayer=a.baseLayer;this.width=a.width||e.w||this.map.width/4;this.height=a.height||e.h||this.map.height/4;this.attachTo=a.attachTo||"top-right";this.expandFactor=
a.expandFactor||2;this.color=a.color||"#000000";this.opacity=a.opacity||0.5;this.maximizeButton=!!a.maximizeButton;this.visible=!!a.visible;if(this.map.loaded)this._initialSetup();else var h=c.connect(this.map,"onLoad",this,function(){c.disconnect(h);h=null;this._initialSetup()});if(this._detached)this.visible=!0;this._maximized=!1}else console.error("esri.dijit.OverviewMap: "+this.NLS_noMap)},startup:function(){this.inherited(arguments);o("ie")?this.domNode.parentElement||this.map.container.appendChild(this.domNode):
this.domNode.parentNode||this.map.container.appendChild(this.domNode);if(this._detached)g.set(this._body,"display","block"),g.set(this._controllerDiv,"display","none"),g.set(this._maximizerDiv,"display","none"),this.map.loaded?this._initialize():c.connect(this.map,"onLoad",this,this._initialize);else{"bottom"===this.attachTo.split("-")[0]&&this.domNode.insertBefore(this._maximizerDiv,this._controllerDiv);this.maximizeButton||d.add(this._maximizerDiv,"ovwDisabledButton");if(this.visible&&this.map.loaded)this.visible=
!1,this.show();d.add(this.domNode,{"top-left":"ovwTL","top-right":"ovwTR","bottom-left":"ovwBL","bottom-right":"ovwBR"}[this.attachTo]);d.add(this._controllerDiv,"ovwShow");d.add(this._maximizerDiv,"ovwMaximize")}g.set(this._focusDiv,"opacity",this.opacity)},destroy:function(){this._deactivate();this.overviewMap&&this.overviewMap.destroy();this.overviewMap=this.baseLayer=null;this.inherited(arguments)},resize:function(a){a&&!(0>=a.w||0>=a.h)&&this._resize(a.w,a.h)},show:function(){if(!this.visible){var a=
this._controllerDiv;a.title=this.NLS_hide;d.remove(a,"ovwShow");d.add(a,"ovwHide");f.show(this._body);f.show(this._maximizerDiv);this._initialize();this.visible=!0}},hide:function(){if(this.visible){var a=this._controllerDiv;a.title=this.NLS_show;d.remove(a,"ovwHide");d.add(a,"ovwShow");this._maximized&&this._maximizeHandler();f.hide(this._body);f.hide(this._maximizerDiv);this._deactivate();this.visible=!1}},_initialSetup:function(){if(this._mainMapLayer=this.map.getLayer(this.map.layerIds[0])){var a=
this.baseLayer||this._mainMapLayer,b=this.map.spatialReference,e=a.spatialReference;if(e.wkid!==b.wkid&&e.wkt!==b.wkt)console.error("esri.dijit.OverviewMap: "+this.NLS_invalidSR);else{b=a.declaredClass;if(a instanceof u)if(-1!==b.indexOf("VETiledLayer"))this.baseLayer=new A({resourceInfo:a.getResourceInfo(),culture:a.culture,mapStyle:a.mapStyle,bingMapsKey:a.bingMapsKey});else if(-1!==b.indexOf("OpenStreetMapLayer"))this.baseLayer=new z({tileServers:a.tileServers});else if(-1!==b.indexOf("WebTiledLayer")){var b=
a.initialExtent,e=a.fullExtent,h=a.tileInfo;this.baseLayer=new a.constructor(a.urlTemplate,{initialExtent:b&&new b.constructor(b.toJson()),fullExtent:e&&new e.constructor(e.toJson()),tileInfo:h&&new h.constructor(h.toJson()),tileServers:a.tileServers&&a.tileServers.slice(0)})}else this.baseLayer=new w(a.url,{resourceInfo:a.getResourceInfo()});else if(a instanceof v)-1!==b.indexOf("ArcGISImageServiceLayer")?this.baseLayer=new y(a.url):(this.baseLayer=new x(a.url),this.baseLayer.setImageFormat("png24"));
else{console.error("esri.dijit.OverviewMap: "+this.NLS_invalidType);return}!this._detached&&this.visible&&this._controllerDiv&&(a=function(){this.visible=!1;this.show()},this.baseLayer.loaded?a.call(this):c.connect(this.baseLayer,"onLoad",this,a))}}else console.error("esri.dijit.OverviewMap: "+this.NLS_noLayer)},_visibilityHandler:function(){this.visible?this.hide():this.show()},_maximizeHandler:function(){var a=this._maximizerDiv;this._maximized?(a.title=this.NLS_maximize,d.remove(a,"ovwRestore"),
d.add(a,"ovwMaximize"),this._resize(this.width,this.height)):(a.title=this.NLS_restore,d.remove(a,"ovwMaximize"),d.add(a,"ovwRestore"),this._resize(this.map.width,this.map.height));this._maximized=!this._maximized},_resize:function(a,b){g.set(this._body,{width:a+"px",height:b+"px"});var e=j.defaults.map.panDuration,c=this.overviewMap;j.defaults.map.panDuration=0;c.resize(!0);c.centerAt(this._focusExtent.getCenter());j.defaults.map.panDuration=e},_initialize:function(){if(this.overviewMap)this._activate();
else{var a;a=this.overviewMap=new s(this.id+"-map",{slider:!1,showAttribution:!1,logo:!1,lods:this._overviewLods,wrapAround180:this.map.wrapAround180});c.connect(a,"onLoad",this,function(){this._map_resize_override=k.hitch(a,this._map_resize_override);a.disableMapNavigation();this._activate()});a.addLayer(this.baseLayer)}},_activate:function(){var a=this.map,b=this.overviewMap;this._moveableHandle=new p(this._focusDiv);this._soeConnect=c.connect(a,"onExtentChange",this,this._syncOverviewMap);this._ufoConnect=
c.connect(a,"onPan",this,this._updateFocus);this._oecConnect=c.connect(b,"onExtentChange",this,this._ovwExtentChangeHandler);this._opaConnect=c.connect(b,"onPan",this,this._ovwPanHandler);this._ozsConnect=c.connect(b,"onZoomStart",this,function(){f.hide(this._focusDiv)});this._ozeConnect=c.connect(b,"onZoomEnd",this,function(){f.show(this._focusDiv)});this._omsConnect=c.connect(this._moveableHandle,"onMoveStop",this,this._moveStopHandler);this._syncOverviewMap(a.extent,null,null,null)},_deactivate:function(){c.disconnect(this._soeConnect);
c.disconnect(this._ufoConnect);c.disconnect(this._oecConnect);c.disconnect(this._opaConnect);c.disconnect(this._ozsConnect);c.disconnect(this._ozeConnect);c.disconnect(this._omsConnect);this._moveableHandle&&this._moveableHandle.destroy()},_syncOverviewMap:function(a){this._suspendPanHandling?this._suspendPanHandling=!1:(this._focusExtent=a,this.overviewMap.setExtent(a.expand(this.expandFactor),!0))},_updateFocus:function(a){if(!this._suspendPanHandling)this._focusExtent=a,this._drawFocusDiv(a)},
_drawFocusDiv:function(a,b){var e=this.overviewMap,c=e.toScreen(new i(a.xmin,a.ymax,e.spatialReference)),d=e.toScreen(new i(a.xmax,a.ymin,e.spatialReference)),e=d.x-c.x,d=d.y-c.y,f=!0;e>this.overviewMap.width&&d>this.overviewMap.height&&(f=!1);g.set(this._focusDiv,{left:c.x+(b?b.x:0)+"px",top:c.y+(b?b.y:0)+"px",width:e+"px",height:d+"px",display:f?"block":"none"})},_moveStopHandler:function(){var a=this._moveableHandle.node.style,b=this._focusExtent,c=this.overviewMap,a=c.toMap(new t(parseInt(a.left,
10),parseInt(a.top,10))),d=new i(b.xmin,b.ymax,c.spatialReference);this._focusExtent=b.offset(a.x-d.x,a.y-d.y);this._maximized?this._maximizeHandler():c.centerAt(this._focusExtent.getCenter());this._suspendPanHandling=!0;this.map.setExtent(this._focusExtent)},_ovwExtentChangeHandler:function(){this._drawFocusDiv(this._focusExtent)},_ovwPanHandler:function(a,b){this._drawFocusDiv(this._focusExtent,b)}})});