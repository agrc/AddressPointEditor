//>>built
require({cache:{"url:esri/dijit/templates/AttributeInspector.html":'<div class="esriAttributeInspector">\r\n    <div class="atiLayerName" dojoAttachPoint="layerName"></div>\r\n    <div class="atiAttributes" dojoAttachPoint="attributeTable"></div>\r\n    <div dojoAttachPoint="attachmentEditor"></div>\r\n    <div class="atiEditorTrackingInfo" dojoAttachPoint="editorTrackingInfoDiv"></div>\r\n    <div class="atiButtons" dojoAttachPoint="editButtons">\r\n        <button  dojoType="dijit.form.Button" class="atiButton atiDeleteButton"  dojoAttachPoint="deleteBtn" dojoAttachEvent="onClick: onDeleteBtn" showLabel="true" type="button">${NLS_deleteFeature}</button>\r\n        <div class="atiNavButtons" dojoAttachPoint="navButtons">\r\n            <div class="atiNavMessage" dojoAttachPoint="navMessage"></div>\r\n            <button  dojoType="dijit.form.Button" iconClass="atiButton atiFirstIcon" dojoAttachPoint="firstFeatureButton" dojoAttachEvent="onClick: onFirstFeature" showLabel="false" type="button">${NLS_first}</button>\r\n            <button  dojoType="dijit.form.Button" iconClass="atiButton atiPrevIcon" dojoAttachPoint="prevFeatureButton" dojoAttachEvent="onClick: onPreviousFeature" showLabel="false" type="button">${NLS_previous}</button>\r\n            <button  dojoType="dijit.form.Button" iconClass="atiButton atiNextIcon" dojoAttachPoint="nextFeatureButton" dojoAttachEvent="onClick: onNextFeature" showLabel="false" type="button">${NLS_next}</button>\r\n            <button  dojoType="dijit.form.Button" iconClass="atiButton atiLastIcon" dojoAttachPoint="lastFeatureButton" dojoAttachEvent="onClick: onLastFeature" showLabel="false" type="button">${NLS_last}</button>\r\n        </div>\r\n    </div>\r\n</div>\r\n'}});
define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/connect","dojo/_base/sniff","dojo/_base/kernel","dojo/has","dojo/dom-style","dojo/dom-construct","esri/kernel","esri/lang","esri/domUtils","esri/layers/InheritedDomain","esri/layers/FeatureLayer","dojo/i18n!esri/nls/jsapi","dojo/fx","dojox/gfx","dijit/_Widget","dijit/_Templated","dijit/Editor","dijit/_editor/plugins/LinkDialog","dijit/_editor/plugins/TextColor","esri/dijit/_EventedWidget","esri/dijit/editing/AttachmentEditor","esri/dijit/editing/Util","esri/tasks/query","dijit/form/DateTextBox","dijit/form/TextBox","dijit/form/NumberTextBox","dijit/form/FilteringSelect","dijit/form/NumberSpinner","dijit/form/Button","dijit/form/SimpleTextarea","dijit/Tooltip","dojo/data/ItemFileReadStore","dojox/date/islamic","dojox/date/islamic/Date","dojox/date/islamic/locale","dojo/text!esri/dijit/templates/AttributeInspector.html"],
function(r,i,g,m,J,s,K,l,h,L,k,n,o,t,u,M,N,v,w,x,O,P,y,z,A,Q,B,C,p,q,D,R,E,F,G,S,T,U,H){var j=r([y,v,w],{declaredClass:"esri.dijit.AttributeInspector",widgetsInTemplate:!0,templateString:H,_navMessage:"( ${idx} ${of} ${numFeatures} )",onUpdate:function(){},onDelete:function(){},onAttributeChange:function(){},onNext:function(){},onReset:function(){},onCancel:function(){},_eventMap:{update:!0,"delete":["feature"],"attribute-change":["feature","fieldName","fieldValue"],next:["feature"],reset:!0,cancel:!0},
constructor:function(a){i.mixin(this,u.widgets.attributeInspector);a=a||{};!a.featureLayer&&!a.layerInfos&&console.error("esri.AttributeInspector: please provide correct parameter in the constructor");this._datePackage=this._getDatePackage(a);this._layerInfos=a.layerInfos||[{featureLayer:a.featureLayer,options:a.options||[]}];this._aiConnects=[];this._selection=[];this._toolTips=[];this._featureIdx=this._numFeatures=0;this._currentFeature=this._currentLInfo=null;this._hideNavButtons=a.hideNavButtons||
!1},postCreate:function(){if(g.every(this._layerInfos,function(a){return a.featureLayer.loaded}))this._initLayerInfos(),this._createAttachmentEditor(),this.onFirstFeature();else{var a=this._layerInfos.length;g.forEach(this._layerInfos,function(b){b=b.featureLayer;if(b.loaded)a--;else var c=m.connect(b,"onLoad",this,function(){m.disconnect(c);c=null;a--;a||(this._initLayerInfos(),this._createAttachmentEditor(),this.onFirstFeature())})},this)}},destroy:function(){this._destroyAttributeTable();g.forEach(this._aiConnects,
m.disconnect);delete this._aiConnects;this._attachmentEditor&&(this._attachmentEditor.destroy(),delete this._attachmentEditor);delete this._layerInfos;this._selection=this._currentFeature=this._currentLInfo=this._attributes=this._layerInfos=null;this.inherited(arguments)},refresh:function(){this._updateSelection()},first:function(){this.onFirstFeature()},last:function(){this.onLastFeature()},next:function(){this.onNextFeature()},previous:function(){this.onPreviousFeature()},showFeature:function(a,
b){if(b)this._createOnlyFirstTime=!0;this._updateSelection([a],b);this._updateUI()},onLayerSelectionChange:function(a,b,c){this._createOnlyFirstTime=!1;this._featureIdx=c===t.SELECTION_NEW?0:this._featureIdx;this._updateSelection();this._updateUI()},onLayerSelectionClear:function(){if(this._selection&&!(0>=this._selection.length))this._featureIdx=this._numFeatures=0,this._selection=[],this._currentLInfo=this._currentFeature=null,this._updateUI()},onLayerEditsComplete:function(a,b,c,d){d=d||[];if(d.length){var e=
this._selection,f=a.featureLayer.objectIdField;g.forEach(d,i.hitch(this,function(a){g.some(e,i.hitch(this,function(b,c){if(b.attributes[f]!==a.objectId)return!1;this._selection.splice(c,1);return!0}))}))}b=b||[];if(b.length)this._selection=A.findFeatures(b,a.featureLayer),this._featureIdx=0;a=this._numFeatures=this._selection?this._selection.length:0;if(b.length&&(b=a?this._selection[this._featureIdx]:null))a=b.getLayer().getEditCapabilities(),(!a.canCreate||a.canUpdate)&&this._showFeature(b);this._updateUI()},
onFieldValueChange:function(a,b){var b="undefined"===typeof b?null:b,c=a.field;"esriFieldTypeDate"===c.type&&(b=b&&b.getTime?b.getTime():b&&b.toGregorian?b.toGregorian().getTime():b);if(this._currentFeature.attributes[c.name]!==b){var d=this._currentLInfo,e=this._currentFeature,f=c.name;if(f===d.typeIdField){var I=this._findFirst(d.types,"id",b);g.forEach(d.fieldInfos,function(a){if((c=a.field)&&c.name!==d.typeIdField)a=a.dijit,this._setFieldDomain(a,I,c)&&a&&(this._setValue(a,e.attributes[c.name]+
""),!1===a.isValid()&&this._setValue(a,null))},this)}this.onAttributeChange(e,f,b)}},onDeleteBtn:function(){this._deleteFeature()},onNextFeature:function(){this._onNextFeature(1)},onPreviousFeature:function(){this._onNextFeature(-1)},onFirstFeature:function(){this._onNextFeature(-1*this._featureIdx)},onLastFeature:function(){this._onNextFeature(this._numFeatures-1-this._featureIdx)},_initLayerInfos:function(){var a=this._layerInfos;this._editorTrackingInfos={};g.forEach(a,this._initLayerInfo,this)},
_initLayerInfo:function(a){var b=a.featureLayer,c,d;this._userIds={};d=b.id;if(b.credential)this._userIds[d]=b.credential.userId;if(a.userId)this._userIds[d]=a.userId;this._connect(b,"onSelectionComplete",i.hitch(this,"onLayerSelectionChange",a));this._connect(b,"onSelectionClear",i.hitch(this,"onLayerSelectionClear",a));this._connect(b,"onEditsComplete",i.hitch(this,"onLayerEditsComplete",a));a.showAttachments=b.hasAttachments?k.isDefined(a.showAttachments)?a.showAttachments:!0:!1;a.hideFields=a.hideFields||
[];a.htmlFields=a.htmlFields||[];a.isEditable=b.isEditable()?k.isDefined(a.isEditable)?a.isEditable:!0:!1;a.typeIdField=b.typeIdField;a.layerId=b.id;a.types=b.types;b.globalIdField&&(c=this._findFirst(a.fieldInfos,"fieldName",b.globalIdField),!c&&!a.showGlobalID&&a.hideFields.push(b.globalIdField));d=this._findFirst(a.fieldInfos,"fieldName",b.objectIdField);!d&&!a.showObjectID&&a.hideFields.push(b.objectIdField);var e=this._getFields(a.featureLayer);if(e){var f=a.fieldInfos||[],f=g.map(f,function(a){return i.mixin({},
a)});f.length?a.fieldInfos=g.filter(g.map(f,i.hitch(this,function(b){var c=b.stringFieldOption||(this._isInFields(b.fieldName,a.htmlFields)?j.STRING_FIELD_OPTION_RICHTEXT:j.STRING_FIELD_OPTION_TEXTBOX);return i.mixin(b,{field:this._findFirst(e,"name",b.fieldName),stringFieldOption:c})})),"return item.field;"):(e=g.filter(e,i.hitch(this,function(b){return!this._isInFields(b.name,a.hideFields)})),a.fieldInfos=g.map(e,i.hitch(this,function(b){var c=this._isInFields(b.name,a.htmlFields)?j.STRING_FIELD_OPTION_RICHTEXT:
j.STRING_FIELD_OPTION_TEXTBOX;return{fieldName:b.name,field:b,stringFieldOption:c}})));a.showGlobalID&&!c&&f.push(this._findFirst(e,"name",b.globalIdField));a.showObjectID&&!d&&f.push(this._findFirst(e,"name",b.objectIdField));c=[];b.editFieldsInfo&&(b.editFieldsInfo.creatorField&&c.push(b.editFieldsInfo.creatorField),b.editFieldsInfo.creationDateField&&c.push(b.editFieldsInfo.creationDateField),b.editFieldsInfo.editorField&&c.push(b.editFieldsInfo.editorField),b.editFieldsInfo.editDateField&&c.push(b.editFieldsInfo.editDateField));
this._editorTrackingInfos[b.id]=c}},_createAttachmentEditor:function(){this._attachmentEditor=null;var a=g.filter(this._layerInfos,function(a){return a.showAttachments});if(a&&a.length)this._attachmentEditor=new z({"class":"atiAttachmentEditor"},this.attachmentEditor),this._attachmentEditor.startup()},_setCurrentLInfo:function(a){var b=this._currentLInfo?this._currentLInfo.featureLayer:null,c=a.featureLayer;if(b&&b.id===c.id&&!b.ownershipBasedAccessControlForFeatures&&(b=c.getEditCapabilities(),!b.canCreate||
b.canUpdate))return;this._currentLInfo=a;this._createTable()},_updateSelection:function(a,b){this._selection=a||[];g.forEach(this._layerInfos,this._getSelection,this);this._showFeature((this._numFeatures=this._selection.length)?this._selection[this._featureIdx]:null,b)},_getSelection:function(a){this._selection=this._selection.concat(a.featureLayer.getSelectedFeatures())},_updateUI:function(){var a=this._numFeatures,b=this._currentLInfo;this.layerName.innerHTML=!b||0===a?this.NLS_noFeaturesSelected:
b.featureLayer?b.featureLayer.name:"";l.set(this.attributeTable,"display",a?"":"none");l.set(this.editButtons,"display",a?"":"none");l.set(this.navButtons,"display",!this._hideNavButtons&&1<a?"":"none");this.navMessage.innerHTML=k.substitute({idx:this._featureIdx+1,of:this.NLS_of,numFeatures:this._numFeatures},this._navMessage);this._attachmentEditor&&l.set(this._attachmentEditor.domNode,"display",b&&b.showAttachments&&a?"":"none");l.set(this.deleteBtn.domNode,"display",!(b&&!1===b.showDeleteButton)&&
this._canDelete?"":"none");if(this.domNode.parentNode&&0<this.domNode.parentNode.scrollTop)this.domNode.parentNode.scrollTop=0},_onNextFeature:function(a){this._featureIdx+=a;if(0>this._featureIdx)this._featureIdx=this._numFeatures-1;else if(this._featureIdx>=this._numFeatures)this._featureIdx=0;a=this._selection.length?this._selection[this._featureIdx]:null;this._showFeature(a);this._updateUI();this.onNext(a)},_deleteFeature:function(){this.onDelete(this._currentFeature)},_showFeature:function(a,
b){if(a){this._currentFeature=a;var c=b?b:a.getLayer(),d=c.getEditCapabilities({feature:a,userId:this._userIds[c.id]});this._canUpdate=d.canUpdate;this._canDelete=d.canDelete;if(d=this._getLInfoFromFeatureLayer(c)){this._setCurrentLInfo(d);var e=a.attributes,f=this._findFirst(d.types,"id",e[d.typeIdField]),h,i=null;g.forEach(d.fieldInfos,function(a){i=a.field;if(h=a.dijit||null){var a=this._setFieldDomain(h,f,i),b=e[i.name],b=b&&a&&a.codedValues&&a.codedValues.length?a.codedValues[b]?a.codedValues[b].name:
b:b;k.isDefined(b)||(b="");if("dijit.form.DateTextBox"===h.declaredClass)b=""===b?null:new Date(b);else if("dijit.form.FilteringSelect"===h.declaredClass)h._lastValueReported=null,b=e[i.name]+"";try{this._setValue(h,b),"dijit.form.FilteringSelect"===h.declaredClass&&!1===h.isValid()&&this._setValue(h,null)}catch(c){h.set("displayedValue",this.NLS_errorInvalid,!1)}}},this);this._attachmentEditor&&d.showAttachments&&this._attachmentEditor.showAttachments(this._currentFeature);(c=c.getEditSummary(a))?
(this.editorTrackingInfoDiv.innerHTML=c,n.show(this.editorTrackingInfoDiv)):n.hide(this.editorTrackingInfoDiv)}}},_setFieldDomain:function(a,b,c){if(!a)return null;var d=c.domain;b&&b.domains&&b.domains[c.name]&&!1===b.domains[c.name]instanceof o&&(d=b.domains[c.name]);if(!d)return null;d.codedValues&&0<d.codedValues.length?(a.set("store",this._toStore(g.map(d.codedValues,function(a){return{id:a.code+="",name:a.name}}))),this._setValue(a,d.codedValues[0].code)):(a.constraints={min:k.isDefined(d.minValue)?
d.minValue:Number.MIN_VALUE,max:k.isDefined(d.maxValue)?d.maxValue:Number.MAX_VALUE},this._setValue(a,a.constraints.min));return d},_setValue:function(a,b){if(a.set)a._onChangeActive=!1,a.set("value",b,!0),a._onChangeActive=!0},_getFields:function(a){var b=a._getOutFields();if(!b)return null;a=a.fields;return"*"==b?a:g.filter(g.map(b,i.hitch(this,"_findFirst",a,"name")),k.isDefined)},_isInFields:function(a,b){return!a||!b&&!b.length?!1:g.some(b,function(b){return b.toLowerCase()===a.toLowerCase()})},
_findFirst:function(a,b,c){return(a=g.filter(a,function(a){return a.hasOwnProperty(b)&&a[b]===c}))&&a.length?a[0]:null},_getLInfoFromFeatureLayer:function(a){return this._findFirst(this._layerInfos,"layerId",a?a.id:null)},_createTable:function(){this._destroyAttributeTable();this.attributeTable.innerHTML="";this._attributes=h.create("table",{cellspacing:"0",cellpadding:"0"},this.attributeTable);var a=h.create("tbody",null,this._attributes),b=this._currentLInfo,c=this._findFirst(b.types,"id",this._currentFeature.attributes[b.typeIdField]);
g.forEach(b.fieldInfos,i.hitch(this,"_createField",c,a),this);this._createOnlyFirstTime=!1},_createField:function(a,b,c){var d=this._currentLInfo,e=c.field;if(!this._isInFields(e.name,d.hideFields)&&!this._isInFields(e.name,this._editorTrackingInfos[d.featureLayer.id])){var f=h.create("tr",null,b),b=h.create("td",{innerHTML:c.label||e.alias||e.name,"class":"atiLabel"},f),b=h.create("td",null,f),f=null,g=!1;if(c.customField)h.place(c.customField.domNode||c.customField,h.create("div",null,b),"first"),
f=c.customField;else if(!1===d.isEditable||!1===e.editable||!1===c.isEditable||"esriFieldTypeOID"===e.type||"esriFieldTypeGlobalID"===e.type||!this._canUpdate&&!this._createOnlyFirstTime)g=!0;!f&&d.typeIdField&&e.name.toLowerCase()==d.typeIdField.toLowerCase()?f=this._createTypeField(e,c,b):f||(f=this._createDomainField(e,c,a,b));if(!f)switch(e.type){case "esriFieldTypeString":f=this._createStringField(e,c,b);break;case "esriFieldTypeDate":f=this._createDateField(e,c,b);break;case "esriFieldTypeInteger":case "esriFieldTypeSmallInteger":f=
this._createIntField(e,c,b);break;case "esriFieldTypeSingle":case "esriFieldTypeDouble":f=this._createFltField(e,c,b);break;default:f=this._createStringField(e,c,b)}c.tooltip&&c.tooltip.length&&this._toolTips.push(new F({connectId:[f.id],label:c.tooltip}));f.onChange=i.hitch(this,"onFieldValueChange",c);f.set("disabled",g);c.dijit=f}},_createTypeField:function(a,b,c){return new q({"class":"atiField",name:a.alias||a.name,store:this._toStore(g.map(this._currentLInfo.types,function(a){return{id:a.id,
name:a.name}})),searchAttr:"name"},h.create("div",null,c))},_createDomainField:function(a,b,c,d){b=a.domain;c&&c.domains&&c.domains[a.name]&&!1===c.domains[a.name]instanceof o&&(b=c.domains[a.name]);return!b?null:b.codedValues?new q({"class":"atiField",name:a.alias||a.name,searchAttr:"name",required:a.nullable||!1},h.create("div",null,d)):new D({"class":"atiField"},h.create("div",null,d))},_createStringField:function(a,b,c){a={"class":"atiField",trim:!0,maxLength:a.length};if(b.stringFieldOption===
j.STRING_FIELD_OPTION_TEXTAREA)return a["class"]+=" atiTextAreaField",new E(a,h.create("div",null,c));return b.stringFieldOption===j.STRING_FIELD_OPTION_RICHTEXT?(a["class"]+=" atiRichTextField",a.height="100%",a.width="100%",a.plugins=b.richTextPlugins||"bold,italic,underline,foreColor,hiliteColor,|,justifyLeft,justifyCenter,justifyRight,justifyFull,|,insertOrderedList,insertUnorderedList,indent,outdent,|,createLink".split(","),new x(a,h.create("div",null,c))):new C(a,h.create("div",null,c))},_createDateField:function(a,
b,c){a={"class":"atiField",trim:!0};if(this._datePackage)a.datePackage=this._datePackage;return new B(a,h.create("div",null,c))},_createIntField:function(a,b,c){return new p({"class":"atiField",constraints:{places:0},invalidMessage:this.NLS_validationInt,trim:!0},h.create("div",null,c))},_createFltField:function(a,b,c){return new p({"class":"atiField",trim:!0,invalidMessage:this.NLS_validationFlt},h.create("div",null,c))},_toStore:function(a){return new G({data:{identifier:"id",label:"name",items:a}})},
_connect:function(a,b,c){this._aiConnects.push(m.connect(a,b,c))},_getDatePackage:function(a){if(null!==a.datePackage){if(a.datePackage)return a.datePackage;if("ar"===s.locale)return"dojox.date.islamic"}return null},_destroyAttributeTable:function(){g.forEach(this._layerInfos,function(a){g.forEach(a.fieldInfos,function(a){var c=a.dijit;if(c){c._onChangeHandle=null;if(a.customField)return;c.destroyRecursive?c.destroyRecursive():c.destroy&&c.destroy()}a.dijit=null},this)},this);g.forEach(this._toolTips,
function(a){a.destroy();delete a});this._toolTips=[];this._attributes&&h.destroy(this._attributes)}});i.mixin(j,{STRING_FIELD_OPTION_RICHTEXT:"richtext",STRING_FIELD_OPTION_TEXTAREA:"textarea",STRING_FIELD_OPTION_TEXTBOX:"textbox"});return j});