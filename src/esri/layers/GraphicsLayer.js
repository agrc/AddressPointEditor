//>>built
define(["dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/_base/array","dojo/dom-attr","dojo/dom-construct","dojo/dom-style","dojox/gfx","dojox/gfx/matrix","esri/kernel","esri/lang","esri/sniff","esri/domUtils","esri/layers/layer","esri/symbols/SimpleMarkerSymbol","esri/geometry/Point","esri/geometry/ScreenPoint","esri/geometry/Extent","esri/geometry/mathUtils","esri/geometry/screenUtils"],function(q,l,p,j,C,G,A,x,t,K,H,k,y,L,u,I,D,B,J,E){var F,M=q(null,{declaredClass:"esri.layers._GraphicsContainer",_setMap:function(a,
b){var c,d=this._connects=[];this._map=a;-1!==x.renderer.toLowerCase().indexOf("canvas")?(c=G.create("div",{style:"overflow: visible; position: absolute;"},b),this._surface={getEventSource:function(){return c}},d.push(l.connect(c,"onmousedown",this,this._canvasDownHandler)),d.push(l.connect(c,"onmouseup",this,this._canvasUpHandler)),d.push(l.connect(c,"onclick",this,this._canvasClickHandler)),F.prototype._canvas=!0):(c=(this._surface=x.createSurface(b,a.width,a.height)).getEventSource(),A.set(c=9>
k("ie")?c.parentNode:c,{overflow:"visible",position:"absolute"}));d.push(l.connect(a,"onResize",this,"_onResizeHandler"));return c},_onResizeHandler:function(a,b,c){var a=this._surface.getEventSource(),d=this._map,e;if(9>k("ie"))A.set(a=a.parentNode,{width:b+"px",height:c+"px",clip:"rect(0px "+b+"px "+c+"px 0px)"});C.set(a,"width",b);C.set(a,"height",c);this._surface.declaredClass||j.forEach(a.childNodes,function(a){C.set(a,"width",b);C.set(a,"height",c)});if(d.loaded){if(!d.graphics.suspended)d.graphics._resized=
!0;j.forEach(d.graphicsLayerIds,function(a){e=d.getLayer(a);if(!e.suspended)e._resized=!0})}},_cleanUp:function(){j.forEach(this._connects,l.disconnect,l);this._map=this._surface=null},_processEvent:function(a){var b=this._map;a.screenPoint=new D(a.pageX-b.position.x,a.pageY-b.position.y);a.mapPoint=b.toMap(a.screenPoint)},_canvasDownHandler:function(a){this._processEvent(a);this._downPt=a.screenPoint.x+","+a.screenPoint.y},_canvasUpHandler:function(a){this._processEvent(a);this._upPt=a.screenPoint.x+
","+a.screenPoint.y},_tolerance:15,_canvasClickHandler:function(a){if(this._downPt&&this._upPt&&this._downPt===this._upPt){this._processEvent(a);var b=this._map,c=j.map(b.graphicsLayerIds,function(a){return b.getLayer(a)});c.push(b.graphics);c.reverse();var c=j.filter(c,function(a){return a.loaded&&a._mouseEvents&&!a.suspended&&(!H.isDefined(a.opacity)||0<a.opacity)}),d=a.screenPoint,e=this._tolerance,g=d.x-e,f=d.y+e,h=d.x+e,e=d.y-e,i=new B(g,e,h,f),g=b.toMap(new D(g,f)),h=b.toMap(new D(h,e)),r=new B(g.x,
g.y,h.x,h.y,g.spatialReference),s,m=k("esri-touch");delete i.spatialReference;j.some(c,function(a){a=j.filter(a.graphics,function(a){var c=a.getDojoShape();if(!a.visible||!c)return!1;var b=c.getTransformedBoundingBox();return b?(a=new B(b[0].x,b[0].y,b[2].x,b[2].y),delete a.spatialReference,m?a.intersects(i):a.contains(d)):j.some(c.children||[],function(a){b=a.getTransformedBoundingBox();a=new B(b[0].x,b[0].y,b[2].x,b[2].y);delete a.spatialReference;return m?a.intersects(i):a.contains(d)})});a.reverse();
if(0<a.length){var c;j.some(a,function(a){return a.geometry&&r.intersects(a.geometry)?(c=a,!0):!1});if(c)return s=c,!0}return!1});if(s&&(c=s.getLayer()))a.graphic=s,c.onClick(a)}}});F=q(L,{declaredClass:"esri.layers._GraphicsLayer",managedSuspension:!0,_eventMap:{"graphic-add":["graphic"],"graphic-remove":["graphic"]},constructor:function(a,b){if(a&&(p.isString(a)||p.isObject(a)&&a.layerDefinition))a=b;this._params=p.mixin({displayOnPan:!0,drawMode:!0},a||{});this.infoTemplate=a&&a.infoTemplate;this.graphics=
[];this._draw=p.hitch(this,this._draw);this._refresh=p.hitch(this,this._refresh);this.registerConnectEvents()},setDrawMode:function(a){this._params.drawMode=a},renderer:null,_setMap:function(a,b){this.inherited(arguments);this._map=a;this._wrap=a.wrapAround180;this._srInfo=a.spatialReference._getInfo();this._canvas?(b=x.createSurface(b.getEventSource(),a.width,a.height),A.set(b.rawNode,"position","absolute"),this._div=b.createGroup(),this._renderProto=this._div.constructor.prototype._render,this._div._render=
p.hitch(this,this._canvasRender)):this._div=b.createGroup();this._div.getEventSource().id=this.id+"_layer";var c=this.opacity;H.isDefined(c)&&1>c&&this.setOpacity(c,!0);return this._div},_unsetMap:function(a,b){j.forEach(this.graphics,function(a){a._shape=null});this._canvas?(b=this._div.getParent(),b._parent={},G.destroy(b.rawNode),b.destroy()):(this._div.clear(),b.remove(this._div),G.destroy(this._div.getEventSource()));this._map=this._div=null;clearTimeout(this._wakeTimer);this._wakeTimer=null;
this._disableDrawConnectors();this.inherited(arguments)},_onZoomStartHandler:function(){y.hide(this._div.getEventSource())},_onExtentChangeHandler:function(a,b,c){clearTimeout(this._wakeTimer);this._wakeTimer=null;if(c)a=this._map.__visibleRect,b=this._div,this._refresh(!0),b.setTransform(t.translate({x:a.x,y:a.y})),this._renderProto&&b.surface.pendingRender?this._dirty=!0:this.suspended||y.show(b.getEventSource());else if(this._resized)this._refresh(!1),this._resized=!1;if(0<this.graphics.length)this.onUpdate()},
_canvasRender:function(){var a=this._div;this._dirty&&(delete this._dirty,this.suspended||y.show(a.getEventSource()));return this._renderProto.apply(a,arguments)},_refresh:function(a){var b=this.graphics,c=b.length,d,e=this._draw;for(d=0;d<c;d++)e(b[d],a)},refresh:function(){this._refresh(!0)},redraw:function(){this._refresh(!0)},_onPanHandler:function(a,b){this._panDx=b.x;this._panDy=b.y;var c=this._map.__visibleRect;this._div.setTransform(t.translate({x:c.x+b.x,y:c.y+b.y}))},_onPanEndUpdateHandler:function(a,
b){if(!this._params._child&&(b.x!==this._panDx||b.y!==this._panDy)){var c=this._map.__visibleRect;this._div.setTransform(t.translate({x:c.x,y:c.y}))}this._refresh(!1);if(this.graphics.length)this.onUpdate()},_onPanStartHandler:function(){y.hide(this._div.getEventSource())},_onPanEndHandler:function(){var a=this._map.__visibleRect,b=this._div;b.setTransform(t.translate({x:a.x,y:a.y}));this._refresh(!1);this._renderProto&&b.surface.pendingRender?this._dirty=!0:y.show(b.getEventSource());if(this.graphics.length)this.onUpdate()},
onSuspend:function(){this.inherited(arguments);y.hide(this._div.getEventSource());clearTimeout(this._wakeTimer);this._wakeTimer=null;this._disableDrawConnectors()},onResume:function(a){this.inherited(arguments);this._enableDrawConnectors();this._wakeTimer=this._wakeTimer||setTimeout(p.hitch(this,function(){this.suspended||this._onExtentChangeHandler(null,null,!0)}),0)},_enableDrawConnectors:function(){var a=this._map,b=l.connect;this._disableDrawConnectors();if(this._params.displayOnPan){if(!this._params._child)this._onPanHandler_connect=
b(a,"onPan",this,"_onPanHandler");this._onPanEndHandler_connect=b(a,"onPanEnd",this,"_onPanEndUpdateHandler")}else this._onPanStartHandler_connect=b(a,"onPanStart",this,"_onPanStartHandler"),this._onPanEndHandler_connect=b(a,"onPanEnd",this,"_onPanEndHandler");this._onZoomStartHandler_connect=b(a,"onZoomStart",this,"_onZoomStartHandler");this._onExtentChangeHandler_connect=b(a,"onExtentChange",this,"_onExtentChangeHandler")},_disableDrawConnectors:function(){var a=l.disconnect;a(this._onExtentChangeHandler_connect);
a(this._onZoomStartHandler_connect);a(this._onPanHandler_connect);a(this._onPanStartHandler_connect);a(this._onPanEndHandler_connect);this._onExtentChangeHandler_connect=this._onZoomStartHandler_connect=this._onPanHandler_connect=this._onPanStartHandler_connect=this._onPanEndHandler_connect=null},_updateExtent:function(a){var b=a.geometry;if(b){if(!(a._extent=b.getExtent())){var c,d;if("esri.geometry.Point"===b.declaredClass)c=b.x,d=b.y;else if("esri.geometry.Multipoint"===b.declaredClass)c=b.points[0][0],
d=b.points[0][1];else{a._extent=null;return}a._extent=new B(c,d,c,d,b.spatialReference)}}else a._extent=null},_intersects:function(a,b,c){var d=a.spatialReference,e=b.spatialReference,g=d&&e&&!d.equals(e)&&d._canProject(e)&&4326===e.wkid;if(this._wrap&&!c){var c=[],d=a._getFrameWidth(),f=this._srInfo,h=a._clip?a._getAvailExtent():a.extent,i,r,s,m,l=[];i=b._partwise;if(g)h=a.geographicExtent,f=e._getInfo();a=h._getParts(f);if(i&&i.length){b=[];for(e=0,g=i.length;e<g;e++)b=b.concat(i[e]._getParts(f))}else b=
b._getParts(f);for(e=0,g=b.length;e<g;e++){s=b[e];for(f=0,h=a.length;f<h;f++)if(m=a[f],m.extent.intersects(s.extent))for(i=0,r=s.frameIds.length;i<r;i++)c.push((m.frameIds[0]-s.frameIds[i])*d)}for(e=0,g=c.length;e<g;e++)i=c[e],j.indexOf(c,i)===e&&l.push(i);return l.length?l:null}return(g?a.geographicExtent:a.extent).intersects(b)?[0]:null},_draw:function(a,b){if(this._params.drawMode&&this._map&&!this.suspended)try{var c=a._extent,d,e;if(a.visible&&c&&(d=this._intersects(this._map,c,a.geometry._originOnly))&&
(e=this._getSymbol(a))){if(!a.getDojoShape()||b||d){var g=a.geometry.type;"point"===g?(this._drawMarker(a,e,d),this._symbolizeMarker(a,e)):"multipoint"===g?(this._drawMarkers(a,e,d),this._symbolizeMarkers(a,e)):(this._drawShape(a,d),this._symbolizeShape(a,e))}}else a.getDojoShape()&&this._removeShape(a)}catch(f){this._errorHandler(f,a)}},_removeShape:function(a){a.getDojoShape().removeShape();a._shape=null},_drawShape:function(a,b){var c=a.geometry,d=c.type,e=this._map,g=e.extent,f=e.width,h=e.height,
e=e.__visibleRect,i=[],r,j;r="extent"===d;if("rect"===d||r){i={x:0,y:0,spatialReference:c.spatialReference};i.x=r?c.xmin:c.x;i.y=r?c.ymax:c.y;d=E.toScreenPoint(g,f,h,i);i.x=r?c.xmax:c.x+c.width;i.y=r?c.ymin:c.y+c.height;c=E.toScreenPoint(g,f,h,i);c={x:d.x-e.x+b[0],y:d.y-e.y,width:Math.abs(c.x-d.x),height:Math.abs(c.y-d.y)};if(0===c.width)c.width=1;if(0===c.height)c.height=1;a._shape=this._drawRect(this._div,a.getDojoShape(),c)}else if("polyline"===d||"polygon"===d){for(r=0,j=b.length;r<j;r++)i=i.concat(E._toScreenPath(g,
f,h,c,-e.x+b[r],-e.y));a._shape=this._drawPath(this._div,a.getDojoShape(),i);this._rendererLimits&&("polyline"===d?this._clipPolyline(a._shape,c):this._clipPolygon(a._shape,c))}},_drawRect:function(a,b,c){return b?b.setShape(c):a.createRect(c)},_drawImage:function(a,b,c){return b?b.setShape(c):a.createImage(c)},_drawCircle:function(a,b,c){return b?b.setShape(c):a.createCircle(c)},_drawPath:function(){return 9>k("ie")?function(a,b,c,d){c=d?c:c.join(" ");if(b)return b.setShape(c);b=a.createObject(d?
x.Path:x.EsriPath,c);a._overrideSize(b.getEventSource());return b}:function(a,b,c,d){c=d?c:c.join(" ");return b?b.setShape(c):a.createPath(c)}}(),_drawText:function(a,b,c){return b?b.setShape(c):a.createText(c)},_getSymbol:function(a){return a.symbol||(this.renderer?this.renderer.getSymbol(a):null)||null},_symbolizeShape:function(a,b){var c=b._stroke,d=b._fill;if(null===c||null===d)c=b.getStroke(),d=b.getFill();a.getDojoShape().setStroke(c).setFill(d);b._stroke=c;b._fill=d},_smsToPath:function(){return 9>
k("ie")?function(a,b,c,d,e,g,f,h,i){switch(b){case a.STYLE_SQUARE:return["M",e+","+f,"L",g+","+f,g+","+h,e+","+h,"X","E"];case a.STYLE_CROSS:return["M",c+","+f,"L",c+","+h,"M",e+","+d,"L",g+","+d,"E"];case a.STYLE_X:return["M",e+","+f,"L",g+","+h,"M",e+","+h,"L",g+","+f,"E"];case a.STYLE_DIAMOND:return["M",c+","+f,"L",g+","+d,c+","+h,e+","+d,"X","E"];case a.STYLE_TARGET:return["M",e+","+f,"L",g+","+f,g+","+h,e+","+h,e+","+f,"M",e-i+","+d,"L",e+","+d,"M",c+","+(f-i),"L",c+","+f,"M",g+i+","+d,"L",g+
","+d,"M",c+","+(h+i),"L",c+","+h,"E"]}}:function(a,b,c,d,e,g,f,h,i){switch(b){case a.STYLE_SQUARE:return["M",e+","+f,g+","+f,g+","+h,e+","+h,"Z"];case a.STYLE_CROSS:return["M",c+","+f,c+","+h,"M",e+","+d,g+","+d];case a.STYLE_X:return["M",e+","+f,g+","+h,"M",e+","+h,g+","+f];case a.STYLE_DIAMOND:return["M",c+","+f,g+","+d,c+","+h,e+","+d,"Z"];case a.STYLE_TARGET:return["M",e+","+f,g+","+f,g+","+h,e+","+h,e+","+f,"M",e-i+","+d,e+","+d,"M",c+","+(f-i),c+","+f,"M",g+i+","+d,g+","+d,"M",c+","+(h+i),
c+","+h]}}}(),_pathStyles:{square:1,cross:1,x:1,diamond:1,target:1},_typeMaps:{picturemarkersymbol:"image",textsymbol:"text"},_isInvalidShape:function(a,b){var c=b&&b.shape&&b.shape.type,d=a&&a.type,e=a&&a.style;e?this._pathStyles[e]&&(e="path"):d&&(e=this._typeMaps[d]);if(c&&e&&c!==e)return!0},_drawPoint:function(a,b,c,d,e){var g=c.type,f=this._map,h=f.__visibleRect,b=E.toScreenPoint(f.extent,f.width,f.height,b).offset(-h.x+e[0],-h.y),f=b.x,h=b.y,i,j=0,l=0;this._isInvalidShape(c,d)&&(d.removeShape(),
d=null);if("simplemarkersymbol"===g){i=c.style;var m=c.size/2,g=Math.round;switch(i){case u.STYLE_SQUARE:case u.STYLE_CROSS:case u.STYLE_X:case u.STYLE_DIAMOND:i=this._drawPath(a,d,this._smsToPath(u,i,f,h,g(f-m),g(f+m),g(h-m),g(h+m)));break;case u.STYLE_TARGET:var m=c._targetWidth/2,k=c._targetHeight/2;i=this._drawPath(a,d,this._smsToPath(u,i,f,h,g(f-m),g(f+m),g(h-k),g(h+k),c._spikeSize));break;case u.STYLE_PATH:i=this._drawPath(a,d,c.path,!0);a=i.getBoundingBox();j=-(a.x+a.width/2)+f;l=-(a.y+a.height/
2)+h;break;default:i=this._drawCircle(a,d,{cx:f,cy:h,r:m})}}else"picturemarkersymbol"===g?(i=c.width,g=c.height,i=this._drawImage(a,d,{x:f-i/2,y:h-g/2,width:i,height:g,src:c.url})):"textsymbol"===g&&(i=this._drawText(a,d,{type:"text",text:c.text,x:f,y:h,align:c.align,decoration:c.decoration,rotated:c.rotated,kerning:c.kerning}));i.setTransform(t.multiply(t.translate(c.xoffset,-c.yoffset),t.rotategAt(c.angle,b),t.translate(j,l)));i._wrapOffsets=e;return i},_symbolizePoint:function(a,b){var c=b.type;
if("picturemarkersymbol"!==c){var d=b._stroke,e=b._fill;if("textsymbol"===c)a.setFont(b.font).setFill(b.getFill());else{if(null===d||null===e)d=b.getStroke(),e=b.getFill();"simplemarkersymbol"===c&&a.setFill(e).setStroke(d);b._stroke=d;b._fill=e}}},_drawMarker:function(a,b,c){a._shape=this._drawPoint(this._div,a.geometry,b,a.getDojoShape(),c)},_symbolizeMarker:function(a,b){this._symbolizePoint(a.getDojoShape(),b)},_drawMarkers:function(a,b,c){var d=a.geometry,e=d.points,g=a.getDojoShape()||this._div.createGroup(),
f,h,i=e.length,j=[],l=0,m,k=c?c.length:0;g.children[0]&&this._isInvalidShape(b,g.children[0])&&g.clear();for(h=0;h<i;h++){f=e[h];for(m=0;m<k;m++)j[0]=c[m],this._drawPoint(g,{x:f[0],y:f[1],spatialReference:d.spatialReference},b,g.children[l++],j)}b=g.children.length;if(i*c.length<b)for(h=b-1;h>=i*c.length;h--)g.children[h].removeShape();a._shape=g},_symbolizeMarkers:function(a,b){var c=a.getDojoShape().children,d,e=c.length;for(d=0;d<e;d++)this._symbolizePoint(c[d],b)},_errorHandler:function(a,b){a.message=
b?"Unable to draw graphic (geometry:"+(b.geometry?b.geometry.declaredClass:null)+", symbol:"+(b.symbol?b.symbol.declaredClass:null)+"): "+a.message:"Unable to draw graphic (null): "+a.message;this.inherited(arguments)},_rendererLimits:function(){var a,b,c;k("ff")?(a=16125,b=-32250,c=32250):9>k("ie")?(a=1E5,b=-1E5,c=1E5):k("chrome")&&6>k("chrome")&&(a=8150,b=-1E4,c=1E4);if(a)return{clipLimit:a,rangeMin:b,rangeMax:c,clipBBox:[-a,-a,a,a],clipSegments:[[[-a,-a],[a,-a]],[[a,-a],[a,a]],[[a,a],[-a,a]],[[-a,
a],[-a,-a]]]}}(),_clipPolyline:function(a,b){var c=this._getCorners(a,b),d=c.br,e=this._rendererLimits,g=e.rangeMin,f=e.rangeMax,h=e.clipBBox,i=e.clipSegments,e=this._isPointWithinRange,l=this._isPointWithinBBox,s=this._getClipperIntersection,m=this._getPlaneIndex;if(!e(c.tl,g,f)||!e(d,g,f)){9>k("ie")&&this._createSegments(a);var p=[];j.forEach(a.segments,function(a){var a=a.args,c=a.length,b=[],d;for(d=0;d<c;d+=2){var e=[a[d],a[d+1]],g=[a[d+2],a[d+3]],f=l(e,h),j=l(g,h);if(f^j){if(j=s([e,g],i))f?
(d?b.push(j[1]):b.push(e,j[1]),p.push(b),b=[]):b.push(j[1],g)}else f?d?b.push(g):b.push(e,g):(j=m(e,h),f=m(g,h),-1===j||-1===f||j===f||(e=s([e,g],i,!0),0<e.length&&(e[j]||(j=e[j[0]]?j[0]:j[1]),e[f]||(f=e[f[0]]?f[0]:f[1]),g=e[j],e=e[f],g&&b.push(g),e&&(b.push(e),p.push(b),b=[]))))}p.push(b)});a.setShape(this._getPathStringFromPaths(p))}},_clipPolygon:function(a,b){var c=this._getCorners(a,b),d=c.br,e=this._rendererLimits,g=e.clipLimit,f=e.rangeMin,h=e.rangeMax,i=e.clipBBox,l=e.clipSegments,e=this._isPointWithinRange,
s=this._isPointWithinBBox,m=this._getClipperIntersection,t=this._getPlaneIndex,u=J._pointLineDistance;if(!e(c.tl,f,h)||!e(d,f,h))9>k("ie")&&this._createSegments(a),c=j.map(a.segments,function(a){var b=a.args,c=b.length,d=[],a=[],e;for(e=0;e<c;e+=2){var f=[b[e],b[e+1]],h=[b[e+2],b[e+3]];if(e===c-2){d.push(f);break}var o=s(f,i),n=s(h,i);d.push(f);if(o^n){if(n=m([f,h],l))f=n[1],f[o?"inOut":"outIn"]=!0,d.push(f),a.push([o?"INOUT":"OUTIN",d.length-1,n[0]])}else if(!o){var o=t(f,i),k=t(h,i);if(!(-1===o||
-1===k||o===k))if(n=m([f,h],l,!0),0<n.length){n[o]||(o=n[o[0]]?o[0]:o[1]);n[k]||(k=n[k[0]]?k[0]:k[1]);f=n[o];h=n[k];if(f)f.outIn=!0,d.push(f),a.push(["OUTIN",d.length-1,o]);if(h)h.inOut=!0,d.push(h),a.push(["INOUT",d.length-1,k])}else p.isArray(o)&&p.isArray(k)&&(n=o.concat(k),n.sort(),"0123"===n.join("")&&(n=[],3===o[0]+o[1]?n.push([g,-g],[-g,g]):n.push([-g,-g],[g,g]),o=u(n[0],[f,h]),f=u(n[1],[f,h]),d.push(o<f?n[0]:n[1])))}}var v=i[0],w=i[1],q=i[2],z=i[3];j.forEach(d,function(a){a[0]<v&&(a[1]>=w&&
a[1]<=z?a[0]=v:(a[0]=v,a[1]=a[1]<w?w:z))});j.forEach(d,function(a){a[1]<w&&(a[0]>=v&&a[0]<=q?a[1]=w:(a[1]=w,a[0]=a[0]<v?v:q))});j.forEach(d,function(a){a[0]>q&&(a[1]>=w&&a[1]<=z?a[0]=q:(a[0]=q,a[1]=a[1]<w?w:z))});j.forEach(d,function(a){a[1]>z&&(a[0]>=v&&a[0]<=q?a[1]=z:(a[1]=z,a[0]=a[0]<v?v:q))});b=0;c=a.length;if(0<c){do{h=a[b];e=a[(b+1)%c];if(h[2]===e[2]&&"INOUT"===h[0]&&"OUTIN"===e[0])if(f=h[1],e=e[1],f<e)for(f+=1;f<e;f++)d[f][2]=!0;else if(f>e){for(f+=1;f<d.length;f++)d[f][2]=!0;for(f=0;f<e;f++)d[f][2]=
!0}b=(b+1)%c}while(0!==b)}c=d[0];b=d[d.length-1];c[2]&&(b[2]=!0,j.some(a,function(a){return 1===a[1]?(d.splice(d.length-1,0,p.clone(d[1])),!0):!1}));d=j.filter(d,function(a){return a[2]?!1:!0});for(b=0;b<d.length-1;b++)if(c=d[b],(e=d[b+1])&&!(c[0]!==e[0]||c[1]!==e[1])){if(e.outIn)c.outIn=!0;else if(e.inOut)c.inOut=!0;d.splice(b+1,1)}c=Math.abs;a=[];for(b=0;b<d.length-1;b++){h=d[b];f=h[0];h=h[1];o=c(f)===g;n=c(h)===g;e=d[b+1];k=e[0];e=e[1];var x=c(k)===g,y=c(e)===g;o&&y?a.push([b+1,[f,e]]):n&&x&&a.push([b+
1,[k,h]])}for(b=a.length-1;0<=b;b--)e=a[b],f=d[e[0]-1],c=d[e[0]],!f.outIn&&!f.inOut&&!c.outIn&&!c.inOut&&d.splice(e[0],0,e[1]);c=d[0];b=d[d.length-1];(c[0]!==b[0]||c[1]!==b[1])&&d.push(c);return d}),a.setShape(this._getPathStringFromPaths(c))},_getCorners:function(a,b){if(9>k("ie")){var c=this._map,d=b.getExtent(),e=d.spatialReference,g=c.toScreen(new I(d.xmin,d.ymax,e)),c=c.toScreen(new I(d.xmax,d.ymin,e));return{tl:g,br:c}}g=a.getTransformedBoundingBox();return{tl:g[0],br:g[2]}},_createSegments:function(a){a.shape.path=
a.vmlPath;a.segmented=!1;a._confirmSegmented();var b=a.segments;if(1<b.length)a.segments=j.filter(b,function(a,b,e){b=e[b+1];return"M"===a.action&&b&&"L"===b.action?(a.args=a.args.concat(b.args),!0):!1})},_getPathStringFromPaths:function(a){9>k("ie")?(a=j.map(a,function(a){return"m "+j.map(a,function(a,b){return(1===b?"l ":"")+a.join(",")}).join(" ")}),a.push("e")):a=j.map(a,function(a){return"M "+j.map(a,function(a){return a.join(",")}).join(" ")});return a.join(" ")},_isPointWithinBBox:function(a,
b){var c=b[1],d=b[2],e=b[3],g=a[0],f=a[1];return g>b[0]&&g<d&&f>c&&f<e?!0:!1},_isPointWithinRange:function(a,b,c){var d=a.x,a=a.y;return d<b||a<b||d>c||a>c?!1:!0},_getClipperIntersection:function(a,b,c){var d,e=J._getLineIntersection2,g=Math.round,f={length:0};for(d=0;4>d;d++){var h=e(a,b[d]);if(h)if(h[0]=g(h[0]),h[1]=g(h[1]),c)f[d]=h,f.length++;else return[d,h]}return c?f:null},_getPlaneIndex:function(a,b){var c=a[0],d=a[1],e=b[0],g=b[1],f=b[2],h=b[3];return c<=e?d>=g&&d<=h?3:d<g?[0,3]:[2,3]:d<=
g?c>=e&&c<=f?0:c<e?[3,0]:[1,0]:c>=f?d>=g&&d<=h?1:d<g?[0,1]:[2,1]:d>=h?c>=e&&c<=f?2:c<e?[3,2]:[1,2]:-1},onGraphicAdd:function(){},onGraphicRemove:function(){},onGraphicsClear:function(){},onOpacityChange:function(){},setInfoTemplate:function(a){this.infoTemplate=a},add:function(a,b){if(a._graphicsLayer===this)return a;b||this.graphics.push(a);a._graphicsLayer=this;this._updateExtent(a);this._draw(a);if(!b)this.onGraphicAdd(a);return a},remove:function(a,b){if(!b){var c;if(-1===(c=j.indexOf(this.graphics,
a)))return null;a=this.graphics.splice(c,1)[0]}a.getDojoShape()&&this._removeShape(a);a._shape=a._graphicsLayer=null;this.onGraphicRemove(a);return a},clear:function(a,b){for(var c=this.graphics;0<c.length;)this.remove(c[0]);if(!b)this.onGraphicsClear()},setOpacity:function(a,b){if(b||this.opacity!=a){var c=this._div;if(c)9>k("ie")?(j.forEach(this.graphics,function(b){var c=b._shape;if(b=c&&c.getNode()){var g=c.strokeStyle,f=b.stroke;if(g&&f)f.opacity=g.color.a*a;c=c.fillStyle;g=b.fill;if(c&&g)"tile"===
g.type?A.set(b,"opacity",a):g.opacity=c.a*a}}),c._esriIeOpacity=a):this._canvas?A.set(c.getEventSource(),"opacity",a):c.getEventSource().setAttribute("opacity",a);this.opacity=a;if(!b)this.onOpacityChange(a)}},setRenderer:function(a){this.renderer=a}});q=q(F,{declaredClass:"esri.layers.GraphicsLayer",constructor:function(){this.enableMouseEvents=p.hitch(this,this.enableMouseEvents);this.disableMouseEvents=p.hitch(this,this.disableMouseEvents);this._processEvent=p.hitch(this,this._processEvent);this._initLayer()},
_initLayer:function(){this.loaded=!0;this.onLoad(this)},_setMap:function(){var a=this.inherited("_setMap",arguments);this.enableMouseEvents();return a},_unsetMap:function(){this.disableMouseEvents();this.inherited("_unsetMap",arguments)},_processEvent:function(a){var b=this._map,c=this.graphics,d=c.length;a.screenPoint=new D(a.pageX-b.position.x,a.pageY-b.position.y);a.mapPoint=b.toMap(a.screenPoint);for(var e,g,f=a.target,h=f.parentNode,b=0;b<d;b++)if(g=c[b],e=g.getDojoShape())if(e=e.getEventSource(),
e===f||e===h)return a.graphic=g,a},_onMouseOverHandler:function(a){if(this._processEvent(a))this.onMouseOver(a)},_onMouseMoveHandler:function(a){if(this._processEvent(a))this.onMouseMove(a)},_onMouseDragHandler:function(a){if(this._processEvent(a))this.onMouseDrag(a)},_onMouseOutHandler:function(a){if(this._processEvent(a))this.onMouseOut(a)},_onMouseDownHandler:function(a){this._downGr=this._downPt=null;if(this._processEvent(a))l.disconnect(this._onmousemove_connect),l.disconnect(this._onmousedrag_connect),
this._onmousedrag_connect=l.connect(this._div.getEventSource(),"onmousemove",this,"_onMouseDragHandler"),this._downGr=a.graphic,this._downPt=a.screenPoint.x+","+a.screenPoint.y,this.onMouseDown(a)},_onMouseUpHandler:function(a){this._upGr=this._upPt=null;if(this._processEvent(a))l.disconnect(this._onmousedrag_connect),l.disconnect(this._onmousemove_connect),this._onmousemove_connect=l.connect(this._div.getEventSource(),"onmousemove",this,"_onMouseMoveHandler"),this._upGr=a.graphic,this._upPt=a.screenPoint.x+
","+a.screenPoint.y,this.onMouseUp(a)},_onClickHandler:function(a){if(this._processEvent(a)){var b=this._downGr,c=this._upGr;if(b&&c&&b===c&&this._downPt===this._upPt){if(9>k("ie"))K._ieGraphic=a.graphic;this.onClick(a)}}},_onDblClickHandler:function(a){if(this._processEvent(a))this.onDblClick(a)},onMouseOver:function(){},onMouseMove:function(){},onMouseDrag:function(){},onMouseOut:function(){},onMouseDown:function(){},onMouseUp:function(){},onClick:function(){},onDblClick:function(){},enableMouseEvents:function(){if(!this._mouseEvents){var a=
l.connect,b=this._div.getEventSource();if(-1===x.renderer.toLowerCase().indexOf("canvas"))this._onmouseover_connect=a(b,"onmouseover",this,"_onMouseOverHandler"),this._onmousemove_connect=a(b,"onmousemove",this,"_onMouseMoveHandler"),this._onmouseout_connect=a(b,"onmouseout",this,"_onMouseOutHandler"),this._onmousedown_connect=a(b,"onmousedown",this,"_onMouseDownHandler"),this._onmouseup_connect=a(b,"onmouseup",this,"_onMouseUpHandler"),this._onclick_connect=a(b,"onclick",this,"_onClickHandler"),
this._ondblclick_connect=a(b,"ondblclick",this,"_onDblClickHandler");this._mouseEvents=!0}},disableMouseEvents:function(){if(this._mouseEvents){var a=l.disconnect;a(this._onmouseover_connect);a(this._onmousemove_connect);a(this._onmousedrag_connect);a(this._onmouseout_connect);a(this._onmousedown_connect);a(this._onmouseup_connect);a(this._onclick_connect);a(this._ondblclick_connect);this._mouseEvents=!1}}});q._GraphicsContainer=M;q._GraphicsLayer=F;return q});