//>>built
define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/has","esri/kernel","esri/graphic","esri/geometry/Polyline","esri/layers/GraphicsLayer"],function(i,m,f,n,o,j,k,l){return i(null,{declaredClass:"esri.layers._TrackManager",constructor:function(a){this.layer=a;this.trackMap={}},initialize:function(a){this.map=a;var b=this.layer,d=b.renderer.trackRenderer;if(d&&"esriGeometryPoint"===b.geometryType){var c=this.container=new l._GraphicsLayer({id:b.id+"_tracks",_child:!0});c.loaded=!0;c.onLoad(c);
c._setMap(a,b._div);c.setRenderer(d)}},addFeatures:function(a){var b,d=this.trackMap,c=this.layer,e=c._trackIdField;f.forEach(a,function(a){b=a.attributes[e];(d[b]=d[b]||[]).push(a)});var g=c._startTimeField,h=c.objectIdField,a=function(a,b){var c=a.attributes[g],d=b.attributes[g];return c===d?a.attributes[h]<b.attributes[h]?-1:1:c<d?-1:1};for(b in d)d[b].sort(a)},drawTracks:function(){var a=this.container;if(a){var b=this.trackMap,d=this.map.spatialReference,c,e,g,h,f,i=this.layer._trackIdField;
for(c in b){e=b[c];g=[];for(h=e.length-1;0<=h;h--)(f=e[h].geometry)&&g.push([f.x,f.y]);e={};e[i]=c;0<g.length&&a.add(new j(new k({paths:[g],spatialReference:d}),null,e))}}},moveLatestToFront:function(){f.forEach(this.getLatestObservations(),function(a){var b=a._shape;b&&b._moveToFront();this._repaint(a,null,!0)},this.layer)},getLatestObservations:function(){var a=[];if(!this.layer.renderer.latestObservationRenderer)return a;var b=this.trackMap,d;for(d in b){var c=b[d];a.push(c[c.length-1])}return a},
clearTracks:function(){var a=this.getLatestObservations();this.trackMap={};var b=this.container;b&&b.clear();f.forEach(a,function(a){this._repaint(a,null,!0)},this.layer)},isLatestObservation:function(a){var b=this.trackMap[a.attributes[this.layer._trackIdField]];return b?b[b.length-1]===a:!1},destroy:function(){var a=this.container;if(a)a.clear(),a._unsetMap(this.map,this.layer._div),this.container=null;this.trackMap=this.layer=this.map=null}})});